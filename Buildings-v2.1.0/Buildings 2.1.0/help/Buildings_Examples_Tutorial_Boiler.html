<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Buildings.Examples.Tutorial.Boiler</title>
<meta name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="&quot;Package with example for how to build a model for boiler with a heating load&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial, sans-serif; }
.modelica, .modelica * { font-size: 9pt; font-family: Courier, monospace; white-space: pre; }
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address { font-weight: normal; }
td      { border: 1px solid #808080; vertical-align: top; }
th      { border: 1px solid #808080; vertical-align: top; font-weight: bold; }
table   { border: 1px solid #808080; border-collapse: collapse; }
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- begin header -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- end header -->

<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE Boiler<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="Buildings.Examples.Tutorial.Boiler"></a><a href="Buildings_Examples_Tutorial.html#Buildings.Examples.Tutorial"
>Buildings.Examples.Tutorial</a>.Boiler</h2>
<p>
<b>Package with example for how to build a model for boiler with a heating load</b><br>
</p>
<h3>Information</h3>

<p>
This package contains examples with step-by-step instructions for how to build
a system model for a boiler with a heat load as shown in the figure below.
The pressure drops of the individual flow branches and the temperatures correspond to design conditions.
The heating system shall be designed to provide <i>20</i> kW, which is the load
needed at <i>-10</i>&deg;C outdoor temperature.
This load already takes into account the heat required for air infiltration and
ventilation.
Using this load and the temperatures shown in the schematic drawing,
the nominal mass flow rates of the individual flow branches should be computed.
From <i>8:00</i> to <i>18:00</i>, there is an internal heat gain of <i>4</i>kW,
which should not be accounted for when sizing the system.
</p>
<p>
The room volume is <i>180</i>m<sup>3</sup>.
To approximate the thermal storage effect of furniture and building constructions,
the heat capacity of the room should be increased by a factor of three.
(Modeling a detailed room heat transfer as implemented in
<a href="Buildings_Rooms.html#Buildings.Rooms"
>
Buildings.Rooms</a> is out of scope for this tutorial.)
</p>
<p>
The space heating shall be switched on if the outdoor temperature is below
<i>16</i>&deg;C and the room temperature is below
<i>20</i>&deg;C.
It shall be switched off if either the outdoor temperature is above
<i>17</i>&deg;C or the room temperature is above
<i>21</i>&deg;C.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/schematics.png"/>
</p>
<p>
The model consists of
</p>
<ol>
<li>
a room with a heating load, approximated as steady-state heat transfer with the environment,
</li>
<li>
a heating loop with a constant bypass and a three-way valve, which is modulated to track the room temperature set point, and
</li>
<li>
a boiler loop with constant mass flow rate, boiler on/off control and control valve
to ensure a minimum return water temperature.
</li>
</ol>
<p>
To explain the implementation of this model, the model has been created in the following stages:
</p>
<ol>
<li>
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System1"
>
Buildings.Examples.Tutorial.Boiler.System1</a>
implements the room model without any heating.
</li>
<li>
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System2"
>
Buildings.Examples.Tutorial.Boiler.System2</a>
adds a radiator that is fed with water at a constant temperature and flow rate.
The pump is switched on and off depending on the room temperature.
</li>
<li>
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System3"
>
Buildings.Examples.Tutorial.Boiler.System3</a>
adds the boiler circuit with open loop control for the boiler and the mixing valves.
</li>
<li>
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>
Buildings.Examples.Tutorial.Boiler.System4</a>
adds closed loop control for the boiler and the pumps.
</li>
<li>
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>
Buildings.Examples.Tutorial.Boiler.System5</a>
adds closed loop control for the two valves.
</li>
<li>
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System6"
>
Buildings.Examples.Tutorial.Boiler.System6</a>
replaces the constant outdoor temperature with weather data from a file,
and changes the valve control from P-control to PI-control.
</li>
<li>
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System7"
>
Buildings.Examples.Tutorial.Boiler.System7</a>
replaces the boiler and pump control using a state machine.
</li>
</ol>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons_ExamplesPackage.html#Modelica.Icons.ExamplesPackage"
>Modelica.Icons.ExamplesPackage</a> (Icon for packages containing runnable examples).</p>
<h3>Package Content</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Package Content">
<tr>
<th>Name</th>
<th>Description</th>
</tr>
<tr>
<td><img src="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" alt="Buildings.Examples.Tutorial.Boiler.System1" width="20" height="20" align="top">&nbsp;<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System1"
>System1</a>
</td>
<td>1st part of the system model, consisting of the room with heat transfer</td>
</tr>
<tr>
<td><img src="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" alt="Buildings.Examples.Tutorial.Boiler.System2" width="20" height="20" align="top">&nbsp;<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System2"
>System2</a>
</td>
<td>2nd part of the system model, consisting of the room with heat transfer and a radiator</td>
</tr>
<tr>
<td><img src="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" alt="Buildings.Examples.Tutorial.Boiler.System3" width="20" height="20" align="top">&nbsp;<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System3"
>System3</a>
</td>
<td>3rd part of the system model, which adds the boiler loop with open loop control</td>
</tr>
<tr>
<td><img src="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" alt="Buildings.Examples.Tutorial.Boiler.System4" width="20" height="20" align="top">&nbsp;<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>System4</a>
</td>
<td>4th part of the system model, which adds closed-loop control for the pumps and the boiler</td>
</tr>
<tr>
<td><img src="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" alt="Buildings.Examples.Tutorial.Boiler.System5" width="20" height="20" align="top">&nbsp;<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>System5</a>
</td>
<td>5th part of the system model, which adds closed-loop control for the valves</td>
</tr>
<tr>
<td><img src="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" alt="Buildings.Examples.Tutorial.Boiler.System6" width="20" height="20" align="top">&nbsp;<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System6"
>System6</a>
</td>
<td>6th part of the system model, which adds weather data and changes to PI control</td>
</tr>
<tr>
<td><img src="Buildings.Examples.Tutori183681cb9fd28122stem1S.png" alt="Buildings.Examples.Tutorial.Boiler.System7" width="20" height="20" align="top">&nbsp;<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System7"
>System7</a>
</td>
<td>7th part of the system model, which implements the on/off control using a state machine</td>
</tr>
</table>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE System1<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" alt="Buildings.Examples.Tutorial.Boiler.System1" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Examples.Tutorial.Boiler.System1"></a><a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</a>.System1</h2>
<p>
<b>1st part of the system model, consisting of the room with heat transfer</b>
<br>
<br><img src="Buildings.Examples.Tutori183681cb9fd28122stem1D.png" alt="Buildings.Examples.Tutorial.Boiler.System1">
</p>
<h3>Information</h3>

<p>
This part of the system model implements the room with a heat gain.
The room is simplified as a volume of air, a prescribed heat source for
the internal convective heat gain, and a heat conductor for steady-state
heat conduction to the outside.
To increase the heat capacity of the room, such as due to heat stored
in furniture and in building constructions, the heat capacity
of the room air was increased by a factor of three.
The convective heat transfer coefficient is lumped into the heat conductor
model.
</p>
<h4>Implementation</h4>
<p>
This section describes step by step how we implemented the model.
</p>
<ol>
<li>
<p>
First, to define the medium properties, we added the declaration
</p>
<pre>
  replaceable package MediumA =
      Buildings.Media.Air;
</pre>
<p>
This will allow the propagation of the medium model to all models that contain air.
In this example, there is only one model with air.
</p>
<p>
We called the medium <code>MediumA</code> to distinguish it from
<code>MediumW</code> that we will use in later versions of the model for components that
have water as a medium. Because we do not anticipate saturated air, we used
the medium model
<a href="Buildings_Media_Air.html#Buildings.Media.Air"
>
Buildings.Media.Air</a>
instead of
<a href="modelica://Buildings.Media.GasesPTDecoupled.MoistAir">
Buildings.Media.GasesPTDecoupled.MoistAir</a>
as the latter is computationally more expensive.
Because in this model, we are not interested in air humidification or
dehumidification, we could have as well used the medium model
<a href="modelica://Buildings.Media.GasesPTDecoupled.SimpleAir">
Buildings.Media.GasesPTDecoupled.SimpleAir</a>.
</p>
<p>
We also defined the system-level parameters
</p>
<pre>
  parameter Modelica.SIunits.Volume V=6*10*3 "Room volume";
  parameter Modelica.SIunits.MassFlowRate mA_flow_nominal = V*6/3600
    "Nominal mass flow rate";
  parameter Modelica.SIunits.HeatFlowRate QRooInt_flow = 4000
    "Internal heat gains of the room";
</pre>
<p>
to declare that the room volume is <i>180</i> m<sup>3</sup>, that the room
has a nominal mass flow rate of <i>6</i> air changes per hour and that
the internal heat gains of the room are <i>4000</i> Watts.
These parameters have been declared at the top-level of the model
as they will be used in several other models.
Declaring them at the top-level allows to propagate them to other
models, and to easily change them at one location should this be required
when revising the model.
</p>
</li>
<li>
<p>
To model the room air, approximated as a completely mixed volume of air,
an instance of
<a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>
Buildings.Fluid.MixingVolumes.MixingVolume</a>
has been used, as this model can be used with dry air or moist air.
The medium model has been set to <code>MediumA</code>, and the nominal mass
flow rate is set to <code>mA_flow_nominal</code>.
The nominal mass flow rate is used for numerical reasons and should be set
to the approximate order of magnitude. It only has an effect if the mass flow
rate is near zero and what "near zero" means depends on the magnitude of
<code>m_flow_nominal</code>, as it is used for the default value of the parameter
<code>m_flow_small</code> on the <code>Assumptions</code> tag of the model.
See also
<a href="Buildings_Fluid_UsersGuide.html#Buildings.Fluid.UsersGuide"
>
Buildings.Fluid.UsersGuide</a>
for an explanation of the purpose of <code>m_flow_small</code>.
</p>
</li>
<li>
<p>
Since we need to increase the heat capacity of the room air to approximate
energy storage in furniture and building constructions, we connected the instance <code>heaCap</code> of
<a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>
Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a>
to the heat port of the room air.
The model <code>heaCap</code> models energy storage. We set its capacity to
<i>C=2*V*1.2*1006</i> J/K. This will increase the total heat capacity
of the room air by a factor of three.
</p>
</li>
<li>
<p>
We used the instance <code>theCon</code> of
<a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>
Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a>
 to model the thermal conductance to the ambient.
Since our room should have a heat loss of <i>20</i> kW at a temperature difference
of <i>30</i> Kelvin, we set the conductance to
<i>G=20000 &frasl; 30</i> W/K.
</p>
</li>
<li>
<p>
We used the instance <code>preHea</code> of
<a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>
Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a>
to model a prescribed heat gain,
such as due to internal heat source.
This model outputs the heat gain which is equal to the value of its
input signal, which is obtained from a time table.
</p>
</li>
<li>
<p>
To define a time-dependent heat gain, we instantiated the block
<a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>
Modelica.Blocks.Sources.CombiTimeTable</a>
and set its name to <code>timTab</code>.
We set the table parameters to
</p>
<pre>
  Modelica.Blocks.Sources.CombiTimeTable timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
      table=[-6*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, 0]) "Time table for internal heat gain";
</pre>
<p>
Note that we set the output to be a periodic signal by configuring
<code>
extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic.
</code>
The first time stamp is <i>-6*3600</i> seconds in order to create
a table that has a periodicity of one day.
We also set the interpolation of the data to using
piece-wise constant segments.
See the documentation of <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>
Modelica.Blocks.Sources.CombiTimeTable</a> for the various options
of this time table.
</p>
</li>
<li>
<p>
Next, we connected its output to the input of the instance <code>preHea</code>.
</p>
</li>
</ol>
<p>
This completes the initial version of the model. When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System1Temperatures.png" border="1"/>
</p>
<p>
To verify the correctness of the model, we can compare the simulated results to the
following analytical solutions:
</p>
<ol>
<li>
<p>
When the internal heat gain is zero, the room temperature should be equal
to the outside temperature.
</p>
</li>
<li>
<p>
At steady-state when the internal heat gain is <i>4000</i> Watts,
the temperature difference to the outside should be
<i>&Delta; T = Q&#775; &frasl; UA = 4000/(20000/30) = 6</i> Kelvin, which
corresponds to a room temperature of <i>-4</i>&deg;C.
</p>
</li>
</ol>
<p>
Both analytical values agree with the simulation results shown in the above figure.
</p>
<p>
An alternative validation can be done by fixing the temperature of the volume to
<i>20</i>&deg;C and plotting the heat flow rate that is needed to maintain
this temperature.
This can be implemented by connecting an instance of
<a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>
Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a>
as shown below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System1PrescribedTemperature.png" border="1"/>
</p>
<p>
When plotting the heat flow rate <code>fixTemp.port.Q_flow</code>, one can see
that the required heat flow rate to keep the temperature at
<i>20</i>&deg;C is
<i>20</i> kW during night, and
<i>16</i> kW during day when the heat gain is active.
</p>
<!-- Notes -->
<h4>Notes</h4>
<p>
For a more realistic model of a room, the model
<a href="Buildings_Rooms.html#Buildings.Rooms.MixedAir"
>
Buildings.Rooms.MixedAir</a>
could have been used.
For transient heat conduction, models from the
package
<a href="Buildings_HeatTransfer_Conduction.html#Buildings.HeatTransfer.Conduction"
>
Buildings.HeatTransfer.Conduction</a>
could have been used.
</p>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a> (Icon for runnable examples).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>Buildings.Media.Air</td><td>&nbsp;</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>V</td><td>6*10*3</td><td>Room volume [m3]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mA_flow_nominal</td><td>V*6/3600</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>QRooInt_flow</td><td>4000</td><td>Internal heat gains of the room [W]</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> System1 <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;1st part of the system model, consisting of the room with heat transfer&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumA =
      <a href="Buildings_Media_Air.html#Buildings.Media.Air"
>Buildings.Media.Air</a>;

  <a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Fluid.MixingVolumes.MixingVolume</a> vol(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System1.MediumA"
>MediumA</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a> theCon(G=20000/30) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Thermal conductance with the ambient&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> V=6*10*3 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Room volume&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mA_flow_nominal = V*6/3600 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal mass flow rate&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> QRooInt_flow = 4000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Internal heat gains of the room&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a> TOut(T=263.15) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outside temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a> preHea <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Prescribed heat flow&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a> heaCap(C=2*V*1.2*1006) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat capacity for furniture and walls&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</a> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
      table=[-6*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, 0]) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Time table for internal heat gain&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, theCon.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(theCon.port_b, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(preHea.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(heaCap.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(timTab.y[1], preHea.Q_flow);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>System1;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE System2<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" alt="Buildings.Examples.Tutorial.Boiler.System2" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Examples.Tutorial.Boiler.System2"></a><a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</a>.System2</h2>
<p>
<b>2nd part of the system model, consisting of the room with heat transfer and a radiator</b>
<br>
<br><img src="Buildings.Examples.Tutori183681cc9fd28121stem2D.png" alt="Buildings.Examples.Tutorial.Boiler.System2">
</p>
<h3>Information</h3>

<p>
This part of the system model adds a radiator with a prescribed mass flow
rate to the system that is implemented in
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System1"
>
Buildings.Examples.Tutorial.Boiler.System1</a>.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System1"
>
Buildings.Examples.Tutorial.Boiler.System1</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System2</code>.
</p>
</li>
<li>
<p>
Since this model uses water as the medium, we declared the water medium model
at the top-level of the model by adding the lines
</p>
<pre>
  replaceable package MediumW =
      Buildings.Media.ConstantPropertyLiquidWater "Medium model";
</pre>
</li>
<li>
<p>
To model the pump, a temperature sensor which we will need later
for the control, and a flow sink, we made instances of the models
<a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>
Buildings.Fluid.Movers.FlowControlled_m_flow</a>
(instance <code>pumRad</code> for the pump that serves the radiators),
<a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>
Buildings.Fluid.Sensors.TemperatureTwoPort</a>
(instance <code>temSup</code>),
<a href="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>
Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</a>
(instance <code>rad</code>), and
<a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>
Buildings.Fluid.Sources.FixedBoundary</a>
(instance <code>sou</code> and <code>sin</code> for the sink and source
reservoirs, which will later be replace by the boiler loop).
</p>
<p>
In all of these instances, we set the medium model to <code>MediumW</code>.
We also made an instance of the model
Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor
(instance <code>temRoo</code>) to measure the room temperature.
We connected the model as shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System2Connections.png" border="1"/>
</p>
<p>
Note that there are two connections from the
radiator to the room volume:
One connection is for the convective heat flow rate, and the other is for the
radiative heat flow rate. For simplicity, we assumed that the air and radiative
temperature of the room are equal.
Furthermore, we simplified the model by using only one radiator instead of multiple
radiators, although this radiator will be quite large as it needs to provide a
heat flow rate of <i>20</i> kW.
</p>
</li>
<li>
<p>
Next, we computed the design mass flow rate for the radiator.
According to the schematic drawing, the radiator should have at
the design conditions a supply water temperature of
<i>50</i>&deg;C and a return water temperature of
<i>40</i>&deg;C.
Thus, we define the radiator mass flow rate as
</p>
<pre>
  parameter Modelica.SIunits.HeatFlowRate Q_flow_nominal = 20000
    "Nominal heat flow rate of radiator";
  parameter Modelica.SIunits.Temperature TRadSup_nominal = 273.15+50
    "Radiator nominal supply water temperature";
  parameter Modelica.SIunits.Temperature TRadRet_nominal = 273.15+40
    "Radiator nominal return water temperature";
  parameter Modelica.SIunits.MassFlowRate mRad_flow_nominal =
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal)
    "Radiator nominal mass flow rate";
</pre>
</li>
<li>
<p>
Now, we set the mass flow rate of <code>pumRad</code> and <code>temSup</code> to
<code>mRad_flow_nominal</code>.
We also set the temperature of the fluid that flows out of <code>sou</code>
to <code>TRadSup_nominal</code>.
We configured the parameters of the radiator model as
</p>
<pre>
  Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2 rad(
    redeclare package Medium = MediumW,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) "Radiator";
</pre>
<p>
We configured the parameters of the pump model as
</p>
<pre>
  Buildings.Fluid.Movers.FlowControlled_m_flow pumRad(
    redeclare package Medium = MediumW,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRad_flow_nominal)
    "Pump for radiator";
</pre>
</li>
<li>
<p>
To enable the pump when the room temperature is below
<i>19</i>&deg;C and to switch it off when the room temperature
is below
<i>21</i>&deg;C,
we implemented the control blocks as shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System2PumpControl.png" border="1"/>
</p>
<p>
In this control sequence, the first block is a hysteresis element,
which is modeled by
<a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>
Modelica.Blocks.Logical.Hysteresis</a>.
It is configured as
</p>
<pre>
  Modelica.Blocks.Logical.Hysteresis hysPum(
    uLow=273.15 + 19,
    uHigh=273.15 + 21)
    "Pump hysteresis";
</pre>
<p>
to output <code>false</code> when the input signal falls below <i>19</i>&deg;C, and
<code>true</code> when the input signal raises above <i>21</i>&deg;C.
Next, we send the output to the instance <code>not1</code>, which outputs
</p>
<pre>
  y= not u
</pre>
<p>
to negate the signal.
The output of this signal is a boolean value, but the pump
input signal is the required mass flow rate.
Thus, we used the block
<a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>
Modelica.Blocks.Math.BooleanToReal</a> to convert the signal.
We set the parameters of the boolean to real converter as
</p>
<pre>
  Modelica.Blocks.Math.BooleanToReal booToReaRad(
        realTrue=mRad_flow_nominal,
        realFalse=0) "Radiator pump signal";
</pre>
<p>
For numerical reasons, in particular in large system models, it is recommended to
continuously change the mass flow rate, as opposed to having a step change.
Therefore,
in the instance <code>pumRad</code>, we leave the parameter
<code>filteredSpeed</code> at its default value <code>true</code>.
This will approximate a continuous change in mass flow rate when the
pump is switched on or off.
Finally, we closed the control loop between the room temperature sensor and the
pump input signal.
</p>
</li>
</ol>
<!-- ============================== -->
<p>
This completes the initial version of the model. When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System2Temperatures.png" border="1"/>
</p>
<p>
The figure shows that the room temperature is maintained at
<i>20</i>&deg;C when the internal heat gain is zero, and controlled around
<i>19</i>&deg;C to <i>21</i>&deg;C when there is an internal heat gain.
The temperature is slightly outside this temperature range because of the
time lag that is caused by the thermal capacity of the radiator.
</p>
<!-- Notes -->
<h4>Notes</h4>
<p>
For a more realistic model of a room, the model
<a href="Buildings_Rooms.html#Buildings.Rooms.MixedAir"
>
Buildings.Rooms.MixedAir</a>
could have been used.
For transient heat conduction, models from the
package
<a href="Buildings_HeatTransfer_Conduction.html#Buildings.HeatTransfer.Conduction"
>
Buildings.HeatTransfer.Conduction</a>
could have been used.
</p>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a> (Icon for runnable examples).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>Buildings.Media.Air</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Buildings.Media.Water</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q_flow_nominal</td><td>20000</td><td>Nominal heat flow rate of radiator [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadSup_nominal</td><td>273.15 + 50</td><td>Radiator nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadRet_nominal</td><td>273.15 + 40</td><td>Radiator nominal return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRad_flow_nominal</td><td>Q_flow_nominal/4200/(TRadSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>V</td><td>6*10*3</td><td>Room volume [m3]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mA_flow_nominal</td><td>V*6/3600</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>QRooInt_flow</td><td>4000</td><td>Internal heat gains of the room [W]</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Medium model</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> System2 <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;2nd part of the system model, consisting of the room with heat transfer and a radiator&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumA =
      <a href="Buildings_Media_Air.html#Buildings.Media.Air"
>Buildings.Media.Air</a>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 2: Water as medium-------------------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumW =
      <a href="Buildings_Media_Water.html#Buildings.Media.Water"
>Buildings.Media.Water</a> <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Medium model&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------Step 4: Design conditions------------------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> Q_flow_nominal = 20000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal heat flow rate of radiator&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadSup_nominal = 273.15+50 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadRet_nominal = 273.15+40 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Fluid.MixingVolumes.MixingVolume</a> vol(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System2.MediumA"
>MediumA</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a> theCon(G=20000/30) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Thermal conductance with the ambient&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> V=6*10*3 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Room volume&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mA_flow_nominal = V*6/3600 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal mass flow rate&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> QRooInt_flow = 4000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Internal heat gains of the room&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a> TOut(T=263.15) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outside temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a> preHea <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Prescribed heat flow&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a> heaCap(C=2*V*1.2*1006) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat capacity for furniture and walls&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</a> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
      table=[-6*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, 0]) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Time table for internal heat gain&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 5: Radiator Model-------------------------//</span>
 <a href="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</a> rad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Radiator&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Fluid.Sources.FixedBoundary</a> sin(nPorts=1, <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</a>) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Sink for mass flow rate&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Fluid.Sensors.TemperatureTwoPort</a> temSup(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</a>,
      m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Supply water temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> temRoo <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Room temperature&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------Step 5: Pump for radiator-----------------------//</span>
<a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for radiator&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Fluid.Sources.FixedBoundary</a> sou(
    nPorts=1,
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System2.MediumW"
>MediumW</a>,
    T=TRadSup_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Sink for mass flow rate&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------Step 6: Pump control--------------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Pump hysteresis&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad(realTrue=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not1 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Negate output of hysteresis&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------//</span>

<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, theCon.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(theCon.port_b, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(preHea.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(heaCap.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(timTab.y[1], preHea.Q_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.port_b, rad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.port_b, sin.ports[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortCon, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortRad, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(sou.ports[1], pumRad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumRad.port_b, temSup.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T, hysPum.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysPum.y, not1.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not1.y, booToReaRad.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad.y, pumRad.m_flow_in);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>System2;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE System3<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" alt="Buildings.Examples.Tutorial.Boiler.System3" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Examples.Tutorial.Boiler.System3"></a><a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</a>.System3</h2>
<p>
<b>3rd part of the system model, which adds the boiler loop with open loop control</b>
<br>
<br><img src="Buildings.Examples.Tutori183681cd9fd28120stem3D.png" alt="Buildings.Examples.Tutorial.Boiler.System3">
</p>
<h3>Information</h3>

<p>
This part of the system model adds the boiler loop with
open loop control to the model that is implemented in
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System2"
>
Buildings.Examples.Tutorial.Boiler.System2</a>.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System2"
>
Buildings.Examples.Tutorial.Boiler.System2</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System3</code>.
</p>
</li>
<li>
<p>
Next, we deleted the sink and source models <code>sin</code> and <code>sou</code>,
as these will be replaced by the boiler loop.
</p>
</li>
<li>
<p>
We made various instances of
<a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>
Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a>
to model flow splitter and mixers.
We also made an instance of
<a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>
Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a>
to model the three-way valves, and
an instance of
<a href="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>
Buildings.Fluid.Boilers.BoilerPolynomial</a>
to model the boiler.
</p>
<p>
Note that we also made an instance of
<a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>
Buildings.Fluid.Sources.FixedBoundary</a>,
which we called <code>preSou</code>.
This is required to set a pressure reference in the water loop, which is a closed system.
For medium models that expand with increasing temperature,
this is also required to accumulate, and to feed back into the system,
the difference in mass due to the thermal expansion of water.
</p>
</li>
<li>
<p>
Next, we parameterized the medium of all these components by
setting it to <code>MediumW</code>.
</p>
<p>
Since the nominal mass flow rate for the
boiler loop is required by several models, we introduced
the following system-level parameters, where
<code>TBoiRet_min</code> will be used to avoid
condensation in the boiler:
</p>
<pre>
  parameter Modelica.SIunits.Temperature TBoiSup_nominal = 273.15+80
    "Boiler nominal supply water temperature";
  parameter Modelica.SIunits.Temperature TBoiRet_min = 273.15+50
    "Boiler minimum return water temperature";
  parameter Modelica.SIunits.MassFlowRate mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min)
    "Boiler nominal mass flow rate";
</pre>
</li>
</ol>
<p>
Next, we set the parameters of the individual component models.
</p>
<ol>
<li>
<p>
We lumped the pressure drop of the boiler loop into the boiler model
and hence set
</p>
<pre>
  Buildings.Fluid.Boilers.BoilerPolynomial boi(
    redeclare package Medium = MediumW,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue()) "Boiler";
</pre>
</li>
<li>
<p>
For the three-way valve in the radiator loop, we used the default pressure drop of
<i>6000</i> Pa.
For its mass flow rate, we introduced the parameter
</p>
<pre>
  parameter Modelica.SIunits.MassFlowRate mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal)
    "Radiator nominal mass flow rate";
</pre>
<p>
This allowed us to configure the valve as
</p>
<pre>
  Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear valRad(
    redeclare package Medium = MediumW,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) "Three-way valve for radiator loop"
</pre>
<p>
where <code>l={0.01,0.01}</code> is a valve leakage of 1%
and <code>dpValve_nominal=6000</code> is the pressure drop of the valve
if it is fully open
and if the mass flow rate is equal to <code>m_flow_nominal</code>.
It is recommended to set the valve leakage to a non-zero value to avoid numerical problems.
A non-zero value also represent a more realistic situation, as most valves have some leakage.
</p>
</li>
<li>
<p>
For the bypass between the valve and the radiator, we note that the
mass flow rate is equal to <code>mRad_flow_nomial - mRadVal_flow_nominal</code>.
This is a fixed bypass that is used to allow the valve to work across
its full range.
We decided to lump the pressure drop of this bypass, and the pressure drop of the
radiator loop, into the instance <code>mix</code>.
Hence, its parameters are
</p>
<pre>
  Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM mix(
    redeclare package Medium =MediumW,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) "Mixer between valve and radiators";
</pre>
<p>
Note the negative values, which are used for the ports where the medium is
outflowing at nominal conditions.
See also the documentation of the model
<a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>
Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a>.
</p>
<p>
We also set the pressure drop of
port 3 of <code>mix</code>
to the same value as the pressure drop of the valve in order
to balance the flows. In practice, this can be done by using a
balance valve, whose pressure drop we lumped into the component
<code>mix</code>.
</p>
</li>
<li>
<p>
Next, we set the pressure drops and flow rates of all flow splitters and mixers.
For the flow splitters and mixers that are connected to another flow splitter or mixer which
already computes the pressure drop of the connecting flow leg, we set the nominal pressure drop
to zero. This will remove the equation for the pressure drop calculation.
However, we chose to still use the mixer and splitters to make sure that
we properly defined the mixing points in the system.
</p>
</li>
<li>
<p>
Next, we connected all fluid ports, and we set open-loop control signals
for the valves, pumps and boilers.
This is implemented using the block
<a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>
Modelica.Blocks.Sources.Constant</a>.
Using open-loop signals allows testing the model prior to
adding the complexity of closed loop control.
To avoid that the boiler overheats, we set its control input to
<code>0.5</code>. Otherwise, the boiler temperature would raise quickly
when the radiator pump is off, and the simulation would stop
with an error message that says that its medium temperature is
outside the allowed range.
</p>
</li>
</ol>
<!-- ============================== -->
<p>
This completes the initial version of the model. When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System3Temperatures.png" border="1"/>
</p>
<p>
The figure shows that the room temperature is around
<i>5</i>&deg;C when the internal heat gain is zero,
i.e., it is at the average of the outside temperature
and the room design temperature.
Since the boiler control signal is <i>0.5</i>,
this indicates that the model is correct.
</p>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a> (Icon for runnable examples).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>Buildings.Media.Air</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Buildings.Media.Water</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q_flow_nominal</td><td>20000</td><td>Nominal heat flow rate of radiator [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadSup_nominal</td><td>273.15 + 50</td><td>Radiator nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadRet_nominal</td><td>273.15 + 40</td><td>Radiator nominal return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRad_flow_nominal</td><td>Q_flow_nominal/4200/(TRadSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiSup_nominal</td><td>273.15 + 70</td><td>Boiler nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiRet_min</td><td>273.15 + 60</td><td>Boiler minimum return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mBoi_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Boiler nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRadVal_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>V</td><td>6*10*3</td><td>Room volume [m3]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mA_flow_nominal</td><td>V*6/3600</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>QRooInt_flow</td><td>4000</td><td>Internal heat gains of the room [W]</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Medium model</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> System3 <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;3rd part of the system model, which adds the boiler loop with open loop control&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumA =
      <a href="Buildings_Media_Air.html#Buildings.Media.Air"
>Buildings.Media.Air</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumW =
      <a href="Buildings_Media_Water.html#Buildings.Media.Water"
>Buildings.Media.Water</a> <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Medium model&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> Q_flow_nominal = 20000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal heat flow rate of radiator&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadSup_nominal = 273.15+50 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadRet_nominal = 273.15+40 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 4: Boiler design values-------------------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiSup_nominal = 273.15+70 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiRet_min = 273.15+60 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler minimum return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------Radiator loop: Three-way valve: mass flow rate----------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</a> vol(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System3.MediumA"
>MediumA</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a> theCon(G=20000/30) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Thermal conductance with the ambient&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> V=6*10*3 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Room volume&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mA_flow_nominal = V*6/3600 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal mass flow rate&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> QRooInt_flow = 4000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Internal heat gains of the room&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a> TOut(T=263.15) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outside temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a> preHea <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Prescribed heat flow&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a> heaCap(C=2*V*1.2*1006) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat capacity for furniture and walls&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</a> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
      table=[-6*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, 0]) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Time table for internal heat gain&quot;</span>;
  <a href="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</a> rad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Radiator&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temSup(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
      m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Supply water temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> temRoo <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Room temperature&quot;</span>;
  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for radiator&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 3: Splitter and mixers------------------------//</span>
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer between valve and radiators&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter of boiler loop bypass&quot;</span>;

  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,-200,0},
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl4(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter for radiator loop valve bypass&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumBoi(
      <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
      energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
      m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for boiler&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------------Step 3: Boiler-------------------------------//</span>
  <a href="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</a> boi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<span style="color: red; font-weight: normal; font-style: normal;">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</span>()) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------Step 3: Three-way Valve---------------------------//</span>
  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for radiator loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</a> preSou(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
      nPorts=1) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</span>;
  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valBoi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for boiler&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temRet(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =
        <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>, m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Return water temperature&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl1(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System3.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</a> const(k=1) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Constant control signal for valves&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</a> conBoi(k=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Constant mass flow rate for boiler pump&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</a> const1(k=0.5) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Constant control signal for valves&quot;</span>;
 <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Pump hysteresis&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad(realTrue=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not1 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Negate output of hysteresis&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, theCon.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(theCon.port_b, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(preHea.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(heaCap.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(timTab.y[1], preHea.Q_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.port_b, rad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortCon, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortRad, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumRad.port_b, temSup.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_b, pumBoi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumBoi.port_b, spl1.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_2, spl.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_2, valRad.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_2, mix.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_3, valBoi.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valBoi.port_2, temRet.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRet.port_b, boi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_a, preSou.ports[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix2.port_2, valBoi.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl4.port_2, mix2.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl2.port_2, spl4.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_3, spl4.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_3, mix2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_3, spl2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_2, pumRad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.port_b, spl2.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(const.y, valRad.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(conBoi.y, pumBoi.m_flow_in);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(const.y, valBoi.y);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(const1.y, boi.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T,hysPum. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysPum.y,not1. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not1.y,booToReaRad. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad.y, pumRad.m_flow_in);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>System3;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE System4<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" alt="Buildings.Examples.Tutorial.Boiler.System4" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Examples.Tutorial.Boiler.System4"></a><a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</a>.System4</h2>
<p>
<b>4th part of the system model, which adds closed-loop control for the pumps and the boiler</b>
<br>
<br><img src="Buildings.Examples.Tutori183681ce9fd28127stem4D.png" alt="Buildings.Examples.Tutorial.Boiler.System4">
</p>
<h3>Information</h3>

<p>
This part of the system model adds to the model that is implemented in
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System3"
>
Buildings.Examples.Tutorial.Boiler.System3</a>
closed loop control for the pumps and the boiler.
The control valves are still open loop control.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System3"
>
Buildings.Examples.Tutorial.Boiler.System3</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System4</code>.
</p>
</li>
<li>
<p>
Next, we added the outdoor temperature sensor <code>senTOut</code>,
which we will use to disable the plant when the outdoor temperature
is warmer than <i>17</i>&deg;C.
This is implemented by the instances <code>hysTOut</code> and
<code>not2</code>, whose output signal is connected
to the block <code>and1</code> as shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System4PlantOnOff.png" border="1"/>
</p>
</li>
<li>
<p>
Similar to the control of the radiator pump, we used a boolean to real
converter, followed by a first order filter, to set the mass flow
rate of the boiler pump.
</p>
</li>
<li>
<p>
Next, for the boiler on/off control, we use again a hysteresis block
(instance <code>hysTBoi</code>), which we configured as
</p>
<pre>
  Modelica.Blocks.Logical.Hysteresis hysTBoi(uLow=273.15 + 70,
                                             uHigh=273.15 + 90)
    "Hysteresis for on/off of boiler";
</pre>
<p>
The output of the hysteresis block is sent to the instance
<code>not3</code>, which negates its input signal.
The output signal of the <code>not3</code> instance is then sent to the
<code>and2</code> block, which ensures that the boiler is only
on when the pumps are on and the temperature is below
<i>70</i>&deg;C, and that the boiler is off if its temperature reaches <i>90</i>&deg;C.
Therefore, the boiler control sequence is as shown below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System4BoilerOnOff.png" border="1"/>
</p>
</li>
</ol>
<!-- ============================================== -->
<p>
This completes the closed loop control of the boiler and the pumps.
When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System4Temperatures.png" border="1"/>
</p>
<p>
The figure shows that the return water temperature
<code>temRet.T</code> is below
<i>50</i>&deg;C for quite some time when the system heats up.
Furthermore, the supply water temperature
<code>temSup.T</code> is oscillating with the boiler temperature.
We will fix these issues by adding closed loop control for the valves in model
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>
Buildings.Examples.Tutorial.Boiler.System5</a>.
</p>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a> (Icon for runnable examples).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>Buildings.Media.Air</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Buildings.Media.Water</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q_flow_nominal</td><td>20000</td><td>Nominal heat flow rate of radiator [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadSup_nominal</td><td>273.15 + 50</td><td>Radiator nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadRet_nominal</td><td>273.15 + 40</td><td>Radiator nominal return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRad_flow_nominal</td><td>Q_flow_nominal/4200/(TRadSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiSup_nominal</td><td>273.15 + 70</td><td>Boiler nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiRet_min</td><td>273.15 + 60</td><td>Boiler minimum return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mBoi_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Boiler nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRadVal_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>V</td><td>6*10*3</td><td>Room volume [m3]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mA_flow_nominal</td><td>V*6/3600</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>QRooInt_flow</td><td>4000</td><td>Internal heat gains of the room [W]</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Medium model</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> System4 <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;4th part of the system model, which adds closed-loop control for the pumps and the boiler&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumA =
      <a href="Buildings_Media_Air.html#Buildings.Media.Air"
>Buildings.Media.Air</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumW =
      <a href="Buildings_Media_Water.html#Buildings.Media.Water"
>Buildings.Media.Water</a> <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Medium model&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> Q_flow_nominal = 20000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal heat flow rate of radiator&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadSup_nominal = 273.15+50 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadRet_nominal = 273.15+40 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 4: Boiler design values-------------------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiSup_nominal = 273.15+70 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiRet_min = 273.15+60 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler minimum return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------Radiator loop: Three-way valve: mass flow rate----------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</a> vol(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System4.MediumA"
>MediumA</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a> theCon(G=20000/30) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Thermal conductance with the ambient&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> V=6*10*3 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Room volume&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mA_flow_nominal = V*6/3600 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal mass flow rate&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> QRooInt_flow = 4000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Internal heat gains of the room&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a> TOut(T=263.15) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outside temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a> preHea <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Prescribed heat flow&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a> heaCap(C=2*V*1.2*1006) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat capacity for furniture and walls&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</a> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
      table=[-6*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, 0]) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Time table for internal heat gain&quot;</span>;
  <a href="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</a> rad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Radiator&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temSup(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
      m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Supply water temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> temRoo <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Room temperature&quot;</span>;
  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for radiator&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 3: Splitter and mixers------------------------//</span>
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer between valve and radiators&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter of boiler loop bypass&quot;</span>;

  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,-200,0},
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl4(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter for radiator loop valve bypass&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumBoi(
      <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
      energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
      m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for boiler&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------------Step 3: Boiler-------------------------------//</span>
  <a href="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</a> boi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<span style="color: red; font-weight: normal; font-style: normal;">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</span>()) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------Step 3: Three-way Valve---------------------------//</span>
  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for radiator loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</a> preSou(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
      nPorts=1) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</span>;
  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valBoi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for boiler&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temRet(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =
        <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>, m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Return water temperature&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl1(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System4.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</a> const(k=1) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Constant control signal for valves&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//---------------------Step 2: Outdoor temperature sensor and control------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysTOut(uLow=273.15 + 16, uHigh=273.15 + 17) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Hysteresis for on/off based on outside temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not2;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> senTOut <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outdoor temperature sensor&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------------Step 4: Boiler hysteresis----------------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysTBoi(uHigh=273.15 + 90,
                                             uLow=273.15 + 70) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Hysteresis for on/off of boiler&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not3;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</a> and1;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 3: Boolean to real: Boiler Pump-----------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad1(realTrue=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</a> and2;

<span style="color: #006400; font-weight: normal; font-style: normal;">//---------------------------------Step 4: Boiler signal------------------------------//</span>
 <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad2(realTrue=1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler signal&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Pump hysteresis&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad(realTrue=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not1 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Negate output of hysteresis&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, theCon.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(theCon.port_b, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(preHea.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(heaCap.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(timTab.y[1], preHea.Q_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.port_b, rad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortCon, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortRad, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumRad.port_b, temSup.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_b, pumBoi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumBoi.port_b, spl1.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_2, spl.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_2, valRad.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_2, mix.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_3, valBoi.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valBoi.port_2, temRet.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRet.port_b, boi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_a, preSou.ports[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix2.port_2, valBoi.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl4.port_2, mix2.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl2.port_2, spl4.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_3, spl4.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_3, mix2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_3, spl2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_2, pumRad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.port_b, spl2.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(const.y, valRad.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(const.y, valBoi.y);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysTOut.y, not2.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(senTOut.port, TOut.port);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysTBoi.y, not3.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not2.y, and1.u2);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.T, hysTBoi.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(senTOut.T, hysTOut.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, booToReaRad1.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, and2.u1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not3.y, and2.u2);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and2.y, booToReaRad2.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad2.y, boi.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T,hysPum. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysPum.y,not1. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not1.y, and1.u1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, booToReaRad.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad.y, pumRad.m_flow_in);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad1.y, pumBoi.m_flow_in);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>System4;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE System5<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" alt="Buildings.Examples.Tutorial.Boiler.System5" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Examples.Tutorial.Boiler.System5"></a><a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</a>.System5</h2>
<p>
<b>5th part of the system model, which adds closed-loop control for the valves</b>
<br>
<br><img src="Buildings.Examples.Tutori183681cf9fd28126stem5D.png" alt="Buildings.Examples.Tutorial.Boiler.System5">
</p>
<h3>Information</h3>

<p>
This part of the system model adds to the model that is implemented in
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>
Buildings.Examples.Tutorial.Boiler.System4</a>
closed loop control for the valves.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>
Buildings.Examples.Tutorial.Boiler.System4</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System5</code>.
</p>
</li>
<li>
<p>
Next, we added closed loop control for the boiler valve as
shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System5BoilerValveControl.png" border="1"/>
</p>
<p>
This is implemented using the constant block
<a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>
Modelica.Blocks.Sources.Constant</a> for the set point,
the PID controller with output limitation
<a href="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>
Buildings.Controls.Continuous.LimPID</a>.
We configured the controller as
</p>
<pre>
  Buildings.Controls.Continuous.LimPID conPIDBoi(
    controllerType=Modelica.Blocks.Types.SimpleController.P,
    k=0.1,
    Ti=120,
    Td=1,
    reverseAction=true) "Controller for valve in boiler loop";
</pre>
<p>
We set the proportional band to <i>10</i> Kelvin, hence <code>k=0.1</code>.
We set the integral time constant to <i>120</i> seconds, which is
the same time as is required to open or close the valve.
These settings turn out to give satisfactory closed loop control performance.
Otherwise, we would need to retune the controller, which is
usually easiest by configuring the controller as a P-controller, then tuning the
proportional gain, and finally changing it to a PI-controller and tuning the
integral time constant.
</p>
<p>
Note that we also set <code>reverseAction=true</code> because 
if the control error, e.g., the difference between set point and measured
temperature, is positive, the valve needs to close (<i>y=0</i>)
because in this condition, the boiler inlet temperature is not yet high enough.
Once it is high enough, the control error will be negative and the valve
can open.
</p>
</li>
<li>
<p>
The valve control for the radiator loop is implemented similar to
the boiler loop, with the exception that the setpoint is computed
using the model
<a href="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>
Buildings.Controls.SetPoints.Table</a> to implement
a set point that shifts as a function of the room temperature.
This instance is called <code>TSetSup</code> in the
control sequence shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System5RadiatorValve.png" border="1"/>
</p>
<p>
Its configuration is
</p>
<pre>
  Controls.SetPoints.Table TSetSup(table=[273.15 + 19, 273.15 + 50;
                                          273.15 + 21, 273.15 + 21])
                                          "Setpoint for supply water temperature";
</pre>
</li>
</ol>
<!-- ============================================== -->
<p>
This completes the closed loop control.
When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System5Temperatures.png" border="1"/>
</p>
<p>
The figure shows that the return water temperature
<code>temRet.T</code>
quickly raises to <i>50</i>&deg;C and the supply water temperature
<code>temSup.T</code>
has smaller oscillations compared to
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System4"
>
Buildings.Examples.Tutorial.Boiler.System4</a>.
</p>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a> (Icon for runnable examples).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>Buildings.Media.Air</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Buildings.Media.Water</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q_flow_nominal</td><td>20000</td><td>Nominal heat flow rate of radiator [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadSup_nominal</td><td>273.15 + 50</td><td>Radiator nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadRet_nominal</td><td>273.15 + 40</td><td>Radiator nominal return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRad_flow_nominal</td><td>Q_flow_nominal/4200/(TRadSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiSup_nominal</td><td>273.15 + 70</td><td>Boiler nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiRet_min</td><td>273.15 + 60</td><td>Boiler minimum return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mBoi_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Boiler nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRadVal_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>V</td><td>6*10*3</td><td>Room volume [m3]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mA_flow_nominal</td><td>V*6/3600</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>QRooInt_flow</td><td>4000</td><td>Internal heat gains of the room [W]</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Medium model</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> System5 <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;5th part of the system model, which adds closed-loop control for the valves&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumA =
      <a href="Buildings_Media_Air.html#Buildings.Media.Air"
>Buildings.Media.Air</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumW =
      <a href="Buildings_Media_Water.html#Buildings.Media.Water"
>Buildings.Media.Water</a> <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Medium model&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> Q_flow_nominal = 20000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal heat flow rate of radiator&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadSup_nominal = 273.15+50 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadRet_nominal = 273.15+40 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 4: Boiler design values-------------------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiSup_nominal = 273.15+70 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiRet_min = 273.15+60 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler minimum return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------Radiator loop: Three-way valve: mass flow rate----------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</a> vol(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System5.MediumA"
>MediumA</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a> theCon(G=20000/30) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Thermal conductance with the ambient&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> V=6*10*3 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Room volume&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mA_flow_nominal = V*6/3600 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal mass flow rate&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> QRooInt_flow = 4000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Internal heat gains of the room&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a> TOut(T=263.15) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outside temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a> preHea <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Prescribed heat flow&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a> heaCap(C=2*V*1.2*1006) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat capacity for furniture and walls&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</a> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
      table=[-6*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, 0]) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Time table for internal heat gain&quot;</span>;
  <a href="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</a> rad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Radiator&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temSup(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
      m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Supply water temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> temRoo <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Room temperature&quot;</span>;
  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for radiator&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 3: Splitter and mixers------------------------//</span>
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer between valve and radiators&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter of boiler loop bypass&quot;</span>;

  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,-200,0},
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl4(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter for radiator loop valve bypass&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumBoi(
      <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
      energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
      m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for boiler&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------------Step 3: Boiler-------------------------------//</span>
  <a href="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</a> boi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<span style="color: red; font-weight: normal; font-style: normal;">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</span>()) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------Step 3: Three-way Valve---------------------------//</span>
  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for radiator loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</a> preSou(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
      nPorts=1) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</span>;
  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valBoi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for boiler&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temRet(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =
        <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>, m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Return water temperature&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl1(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System5.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//---------------------Step 2: Outdoor temperature sensor and control------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysTOut(uLow=273.15 + 16, uHigh=273.15 + 17) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Hysteresis for on/off based on outside temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not2;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> senTOut <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outdoor temperature sensor&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------------Step 4: Boiler hysteresis----------------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysTBoi(uHigh=273.15 + 90,
                                             uLow=273.15 + 70) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Hysteresis for on/off of boiler&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not3;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</a> and1;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 3: Boolean to real: Boiler Pump-----------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad1(realTrue=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</a> and2;

<span style="color: #006400; font-weight: normal; font-style: normal;">//---------------------------------Step 4: Boiler signal------------------------------//</span>
 <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad2(realTrue=1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler signal&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Pump hysteresis&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad(realTrue=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not1 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Negate output of hysteresis&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------Step 2: Boiler loop valve control-----------------------//</span>
 <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</a> TSetBoiRet(k=TBoiRet_min) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature setpoint for boiler return&quot;</span>;
  <a href="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</a> conPIDBoi(
    Td=1,
    Ti=120,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1,
    reverseAction=true) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Controller for valve in boiler loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------Step 3: Radiator loop valve control-----------------------//</span>
  <a href="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>Controls.SetPoints.Table</a> TSetSup(table=[273.15 + 19, 273.15 + 50;
                                          273.15 + 21, 273.15 + 21]) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Setpoint for supply water temperature&quot;</span>;
  <a href="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</a> conPIDRad(
    Td=1,
    Ti=120,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Controller for valve in radiator loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------//</span>

<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, theCon.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(theCon.port_b, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(preHea.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(heaCap.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(timTab.y[1], preHea.Q_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.port_b, rad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortCon, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortRad, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumRad.port_b, temSup.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_b, pumBoi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumBoi.port_b, spl1.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_2, spl.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_2, valRad.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_2, mix.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_3, valBoi.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valBoi.port_2, temRet.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRet.port_b, boi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_a, preSou.ports[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix2.port_2, valBoi.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl4.port_2, mix2.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl2.port_2, spl4.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_3, spl4.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_3, mix2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_3, spl2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_2, pumRad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.port_b, spl2.port_1);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysTOut.y, not2.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(senTOut.port, TOut.port);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysTBoi.y, not3.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not2.y, and1.u2);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.T, hysTBoi.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(senTOut.T, hysTOut.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, booToReaRad1.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, and2.u1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not3.y, and2.u2);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and2.y, booToReaRad2.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad2.y, boi.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T,hysPum. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysPum.y,not1. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not1.y, and1.u1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, booToReaRad.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T, TSetSup.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TSetSup.y, conPIDRad.u_s);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.T, conPIDRad.u_m);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(conPIDRad.y, valRad.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad.y, pumRad.m_flow_in);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad1.y, pumBoi.m_flow_in);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(conPIDBoi.y, valBoi.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TSetBoiRet.y, conPIDBoi.u_s);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRet.T, conPIDBoi.u_m);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>System5;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE System6<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" alt="Buildings.Examples.Tutorial.Boiler.System6" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Examples.Tutorial.Boiler.System6"></a><a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</a>.System6</h2>
<p>
<b>6th part of the system model, which adds weather data and changes to PI control</b>
<br>
<br><img src="Buildings.Examples.Tutori183681d09fd28125stem6D.png" alt="Buildings.Examples.Tutorial.Boiler.System6">
</p>
<h3>Information</h3>

<p>
This part of the system model adds to the model that is implemented in
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>
Buildings.Examples.Tutorial.Boiler.System5</a>
weather data, and it changes the control to PI control.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System5"
>
Buildings.Examples.Tutorial.Boiler.System5</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System6</code>.
</p>
</li>
<li>
<p>
Next, we added the weather data as shown in the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System6Weather.png" border="1"/>
</p>
<p>
The weather data reader is implemented using
</p>
<pre>
  BoundaryConditions.WeatherData.ReaderTMY3 weaDat(
    filNam="modelica://Buildings/Resources/weatherdata/USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.mos")
    "Weather data reader";
</pre>
<p>
The yellow icon in the middle of the figure is an instance of
<a href="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>
Buildings.BoundaryConditions.WeatherData.Bus</a>.
This is required to extract the dry bulb temperature from the weather data bus.
</p>
<p>
Note that we changed the instance <code>TOut</code> from
<a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.FixedTemperature"
>
Modelica.Thermal.HeatTransfer.Sources.FixedTemperature</a>
to
<a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature"
>
Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature</a>
in order to use the dry-bulb temperature as an input signal.
</p>
</li>
</ol>
<!-- ============================================== -->
<p>
This completes the closed loop control.
When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System6Temperatures1.png" border="1"/>
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System6Temperatures2.png" border="1"/>
</p>
<p>
The figure shows that the boiler temperature is regulated between
<i>70</i>&deg;C and
<i>90</i>&deg;C,
that
the boiler inlet temperature is above
<i>60</i>&deg;C,
and that the room temperature and the supply water temperature are
maintained at their set point.
</p>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a> (Icon for runnable examples).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>Buildings.Media.Air</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Buildings.Media.Water</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q_flow_nominal</td><td>20000</td><td>Nominal heat flow rate of radiator [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadSup_nominal</td><td>273.15 + 50</td><td>Radiator nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadRet_nominal</td><td>273.15 + 40</td><td>Radiator nominal return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRad_flow_nominal</td><td>Q_flow_nominal/4200/(TRadSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiSup_nominal</td><td>273.15 + 70</td><td>Boiler nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiRet_min</td><td>273.15 + 60</td><td>Boiler minimum return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mBoi_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Boiler nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRadVal_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>V</td><td>6*10*3</td><td>Room volume [m3]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mA_flow_nominal</td><td>V*6/3600</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>QRooInt_flow</td><td>4000</td><td>Internal heat gains of the room [W]</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Medium model</td></tr>
<tr><td><a href="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>Bus</a></td><td>weaBus</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> System6 <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;6th part of the system model, which adds weather data and changes to PI control&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumA =
      <a href="Buildings_Media_Air.html#Buildings.Media.Air"
>Buildings.Media.Air</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumW =
      <a href="Buildings_Media_Water.html#Buildings.Media.Water"
>Buildings.Media.Water</a> <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Medium model&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> Q_flow_nominal = 20000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal heat flow rate of radiator&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadSup_nominal = 273.15+50 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadRet_nominal = 273.15+40 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiSup_nominal = 273.15+70 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiRet_min = 273.15+60 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler minimum return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------Radiator loop: Three-way valve: mass flow rate----------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;

  <a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</a> vol(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System6.MediumA"
>MediumA</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a> theCon(G=20000/30) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Thermal conductance with the ambient&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> V=6*10*3 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Room volume&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mA_flow_nominal = V*6/3600 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal mass flow rate&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> QRooInt_flow = 4000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Internal heat gains of the room&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a> preHea <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Prescribed heat flow&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a> heaCap(C=2*V*1.2*1006) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat capacity for furniture and walls&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</a> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
      table=[-6*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, 0]) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Time table for internal heat gain&quot;</span>;
  <a href="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</a> rad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Radiator&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temSup(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
      m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Supply water temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> temRoo <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Room temperature&quot;</span>;
  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for radiator&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer between valve and radiators&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter of boiler loop bypass&quot;</span>;

  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,-200,0},
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl4(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter for radiator loop valve bypass&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumBoi(
      <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
      energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
      m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for boiler&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</a> boi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<span style="color: red; font-weight: normal; font-style: normal;">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</span>()) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for radiator loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</a> preSou(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
      nPorts=1) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</span>;
  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valBoi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for boiler&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temRet(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =
        <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>, m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Return water temperature&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl1(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System6.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysTOut(uLow=273.15 + 16, uHigh=273.15 + 17) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Hysteresis for on/off based on outside temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not2;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> senTOut <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outdoor temperature sensor&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysTBoi(uHigh=273.15 + 90,
                                             uLow=273.15 + 70) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Hysteresis for on/off of boiler&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not3;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</a> and1;
<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------//</span>

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad1(realTrue=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------//</span>

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</a> and2;

 <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad2(realTrue=1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler signal&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------//</span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Hysteresis"
>Modelica.Blocks.Logical.Hysteresis</a> hysPum(uLow=273.15 + 19,
                                            uHigh=273.15 + 21) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Pump hysteresis&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad(realTrue=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not1 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Negate output of hysteresis&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</a> TSetBoiRet(k=TBoiRet_min) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature setpoint for boiler return&quot;</span>;

 <a href="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</a> conPIDBoi(
    Td=1,
    Ti=120,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1,
    reverseAction=true) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Controller for valve in boiler loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------//</span>

  <a href="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>Controls.SetPoints.Table</a> TSetSup(table=[273.15 + 19, 273.15 + 50;
                                          273.15 + 21, 273.15 + 21]) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Setpoint for supply water temperature&quot;</span>;
  <a href="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</a> conPIDRad(
    Td=1,
    Ti=120,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Controller for valve in radiator loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//--- Weather data -------------------------------------------------------------//</span>
  <a href="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.ReaderTMY3"
>BoundaryConditions.WeatherData.ReaderTMY3</a> weaDat(
    filNam=&quot;modelica://Buildings/Resources/weatherdata/USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.mos&quot;) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Weather data reader&quot;</span>;
  <a href="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>BoundaryConditions.WeatherData.Bus</a> weaBus;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature</a> TOut <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outside temperature&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(theCon.port_b, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(preHea.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(heaCap.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(timTab.y[1], preHea.Q_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.port_b, rad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortCon, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortRad, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumRad.port_b, temSup.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_b, pumBoi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumBoi.port_b, spl1.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_2, spl.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_2, valRad.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_2, mix.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_3, valBoi.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valBoi.port_2, temRet.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRet.port_b, boi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_a, preSou.ports[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix2.port_2, valBoi.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl4.port_2, mix2.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl2.port_2, spl4.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_3, spl4.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_3, mix2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_3, spl2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_2, pumRad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.port_b, spl2.port_1);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysTOut.y, not2.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysTBoi.y, not3.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not2.y, and1.u2);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.T, hysTBoi.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(senTOut.T, hysTOut.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, booToReaRad1.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, and2.u1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not3.y, and2.u2);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and2.y, booToReaRad2.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad2.y, boi.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T,hysPum. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hysPum.y,not1. u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not1.y, and1.u1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, booToReaRad.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T, TSetSup.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TSetSup.y, conPIDRad.u_s);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.T, conPIDRad.u_m);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(weaDat.weaBus, weaBus);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(weaBus.TDryBul, TOut.T);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, theCon.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, senTOut.port);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad.y, pumRad.m_flow_in);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(conPIDRad.y, valRad.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad1.y, pumBoi.m_flow_in);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(conPIDBoi.y, valBoi.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TSetBoiRet.y, conPIDBoi.u_s);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRet.T, conPIDBoi.u_m);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>System6;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE System7<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Examples.Tutori183681cb9fd28122stem1I.png" alt="Buildings.Examples.Tutorial.Boiler.System7" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Examples.Tutorial.Boiler.System7"></a><a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler"
>Buildings.Examples.Tutorial.Boiler</a>.System7</h2>
<p>
<b>7th part of the system model, which implements the on/off control using a state machine</b>
<br>
<br><img src="Buildings.Examples.Tutori183681d19fd28124stem7D.png" alt="Buildings.Examples.Tutorial.Boiler.System7">
</p>
<h3>Information</h3>

<p>
This part of the system model changes the implementation of the control in
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System6"
>
Buildings.Examples.Tutorial.Boiler.System6</a>
to use a state machine to switch the pumps and the boiler on and off.
State machines provide an alternate way to implement discrete event,
reactive and hybrid systems.
The state machine that is implemented in this model is shown in
the figure below.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/stateMachine.png" border="1"/>
</p>
<p>
In the figure above, the ovals depict states, and the arrows are transitions between the states.
The transitions fire when the conditions are true.
</p>
<h4>Implementation</h4>
<p>
This model was built as follows:
</p>
<ol>
<li>
<p>
First, we copied the model
<a href="Buildings_Examples_Tutorial_Boiler.html#Buildings.Examples.Tutorial.Boiler.System6"
>
Buildings.Examples.Tutorial.Boiler.System6</a>
and called it
<code>Buildings.Examples.Tutorial.Boiler.System7</code>.
</p>
</li>
<li>
<p>
We implemented the state machine using blocks from the library
<a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2"
>
Modelica_StateGraph2</a>.
How to use these blocks is explained in the
user's guide of the
<a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2"
>
Modelica_StateGraph2</a>
library.
</p>
<p>
The figure below shows the state machine.
The oval icons are states, and the black bars
are transitions. The transitions are enabled when their input signal is true.
The red numbers to the right of the transition indicate the delay in seconds.
If a delay is present, the input needs to be true during the entire duration of the delay
for a transition to fire.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System7StateMachine.png" border="1"/>
</p>
<p>
In our implementation, the state <code>allOff</code> is the initial state,
indicated by its black arrow.
The transition <code>T1</code> is used to switch the pumps on.
Once the pumps are on, transition <code>T2</code> may fire, which
would switch the boiler on.
Hence, the boiler can only be on when the pumps are on.
From the state <code>boilerOn</code>, the only next step can be to
transition to the state <code>pumpsOn</code>.
Once this state has been reached (and hence the boiler is off),
the pumps can be switched off when transition <code>T4</code> fires.
Note that the transitions <code>T3</code> and <code>T4</code>
only fire when their input is true for the entire duration of <i>10</i> seconds.
Hence, the pumps and the boiler must run for at least <i>10</i> seconds
before they can be switched off.
</p>
</li>
</ol>
<!-- ============================================== -->
<p>
When simulating the model
for <i>2</i> days, or <i>172800</i> seconds, the
response shown below should be seen.
</p>
<p align="center">
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System7Temperatures1.png" border="1"/>
<img alt="image" src="../Resources/Images/Examples/Tutorial/Boiler/System7Temperatures2.png" border="1"/>
</p>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a> (Icon for runnable examples).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>Buildings.Media.Air</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Buildings.Media.Water</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q_flow_nominal</td><td>20000</td><td>Nominal heat flow rate of radiator [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadSup_nominal</td><td>273.15 + 50</td><td>Radiator nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TRadRet_nominal</td><td>273.15 + 40</td><td>Radiator nominal return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRad_flow_nominal</td><td>Q_flow_nominal/4200/(TRadSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiSup_nominal</td><td>273.15 + 70</td><td>Boiler nominal supply water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TBoiRet_min</td><td>273.15 + 60</td><td>Boiler minimum return water temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mBoi_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Boiler nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mRadVal_flow_nominal</td><td>Q_flow_nominal/4200/(TBoiSup...</td><td>Radiator nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>V</td><td>6*10*3</td><td>Room volume [m3]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mA_flow_nominal</td><td>V*6/3600</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>QRooInt_flow</td><td>4000</td><td>Internal heat gains of the room [W]</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumA</td><td>&nbsp;</td></tr>
<tr><td colspan="2">replaceable package MediumW</td><td>Medium model</td></tr>
<tr><td><a href="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>Bus</a></td><td>weaBus</td><td>&nbsp;</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> System7 <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;7th part of the system model, which implements the on/off control using a state machine&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumA =
      <a href="Buildings_Media_Air.html#Buildings.Media.Air"
>Buildings.Media.Air</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumW =
      <a href="Buildings_Media_Water.html#Buildings.Media.Water"
>Buildings.Media.Water</a> <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Medium model&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> Q_flow_nominal = 20000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal heat flow rate of radiator&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadSup_nominal = 273.15+50 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TRadRet_nominal = 273.15+40 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRad_flow_nominal=
    Q_flow_nominal/4200/(TRadSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiSup_nominal = 273.15+70 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal supply water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TBoiRet_min = 273.15+60 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler minimum return water temperature&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mBoi_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TBoiRet_min) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Boiler nominal mass flow rate&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------//</span>

<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------Radiator loop: Three-way valve: mass flow rate----------------//</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mRadVal_flow_nominal=
    Q_flow_nominal/4200/(TBoiSup_nominal-TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator nominal mass flow rate&quot;</span>;

  <a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>Buildings.Fluid.MixingVolumes.MixingVolume</a> vol(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumA.html#Buildings.Examples.Tutorial.Boiler.System7.MediumA"
>MediumA</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mA_flow_nominal,
    V=V);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.ThermalConductor"
>Modelica.Thermal.HeatTransfer.Components.ThermalConductor</a> theCon(G=20000/30) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Thermal conductance with the ambient&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> V=6*10*3 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Room volume&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mA_flow_nominal = V*6/3600 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal mass flow rate&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> QRooInt_flow = 4000 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Internal heat gains of the room&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedHeatFlow</a> preHea <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Prescribed heat flow&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a> heaCap(C=2*V*1.2*1006) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat capacity for furniture and walls&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.CombiTimeTable"
>Modelica.Blocks.Sources.CombiTimeTable</a> timTab(
      extrapolation=Modelica.Blocks.Types.Extrapolation.Periodic,
      smoothness=Modelica.Blocks.Types.Smoothness.ConstantSegments,
      table=[-6*3600, 0;
              8*3600, QRooInt_flow;
             18*3600, 0]) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Time table for internal heat gain&quot;</span>;
  <a href="Buildings_Fluid_HeatExchangers_Radiators.html#Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2"
>Buildings.Fluid.HeatExchangers.Radiators.RadiatorEN442_2</a> rad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    Q_flow_nominal=Q_flow_nominal,
    T_a_nominal=TRadSup_nominal,
    T_b_nominal=TRadRet_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Radiator&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temSup(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
      m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Supply water temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> temRoo <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Room temperature&quot;</span>;
  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for radiator&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mRadVal_flow_nominal,
                   -mRad_flow_nominal,
                   mRad_flow_nominal-mRadVal_flow_nominal},
    dp_nominal={100,-8000,6750}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer between valve and radiators&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,
                   -mRadVal_flow_nominal,
                   -mBoi_flow_nominal},
    dp_nominal={200,-200,-50}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter of boiler loop bypass&quot;</span>;

  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,0,0},
    m_flow_nominal={mRad_flow_nominal,-mRadVal_flow_nominal,-mRad_flow_nominal +
        mRadVal_flow_nominal});
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> mix2(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    dp_nominal={0,-200,0},
    m_flow_nominal={mRadVal_flow_nominal,-mBoi_flow_nominal,mBoi_flow_nominal}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Mixer&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl4(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal*{1,-1,-1},
    dp_nominal=200*{1,-1,-1}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter for radiator loop valve bypass&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Movers.html#Buildings.Fluid.Movers.FlowControlled_m_flow"
>Buildings.Fluid.Movers.FlowControlled_m_flow</a> pumBoi(
      <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
      energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
      m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pump for boiler&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Boilers.html#Buildings.Fluid.Boilers.BoilerPolynomial"
>Buildings.Fluid.Boilers.BoilerPolynomial</a> boi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    dp_nominal=2000,
    Q_flow_nominal=Q_flow_nominal,
    fue=<span style="color: red; font-weight: normal; font-style: normal;">Buildings.Fluid.Data.Fuels.HeatingOilLowerHeatingValue</span>()) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valRad(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mRadVal_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for radiator loop&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//----------------------------------------------------------------------------//</span>

  <a href="Buildings_Fluid_Sources.html#Buildings.Fluid.Sources.FixedBoundary"
>Buildings.Fluid.Sources.FixedBoundary</a> preSou(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
      nPorts=1) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Source for pressure and to account for thermal expansion of water&quot;</span>;
  <a href="Buildings_Fluid_Actuators_Valves.html#Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear"
>Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</a> valBoi(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal=mBoi_flow_nominal,
    l={0.01,0.01},
    dpValve_nominal=6000) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Three-way valve for boiler&quot;</span>;
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.TemperatureTwoPort"
>Buildings.Fluid.Sensors.TemperatureTwoPort</a> temRet(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =
        <a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>, m_flow_nominal=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Return water temperature&quot;</span>;
  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM"
>Buildings.Fluid.FixedResistances.SplitterFixedResistanceDpM</a> spl1(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium=<a href="Buildings_Examples_Tutorial_Boiler_MediumW.html#Buildings.Examples.Tutorial.Boiler.System7.MediumW"
>MediumW</a>,
    energyDynamics=Modelica.Fluid.Types.Dynamics.FixedInitial,
    m_flow_nominal={mBoi_flow_nominal,-mBoi_flow_nominal,-mBoi_flow_nominal},
    dp_nominal={0,0,-200}) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Splitter&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//------------------------------------------------------------------------------------//</span>

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> senTOut <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outdoor temperature sensor&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad1(realTrue=mBoi_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad2(realTrue=1) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.BooleanToReal"
>Modelica.Blocks.Math.BooleanToReal</a> booToReaRad(realTrue=mRad_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Radiator pump signal&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.Constant"
>Modelica.Blocks.Sources.Constant</a> TSetBoiRet(k=TBoiRet_min) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature setpoint for boiler return&quot;</span>;
  <a href="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</a> conPIDBoi(
    Td=1,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1,
    Ti=120,
    reverseAction=true) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Controller for valve in boiler loop&quot;</span>;
  <a href="Buildings_Controls_SetPoints.html#Buildings.Controls.SetPoints.Table"
>Controls.SetPoints.Table</a> TSetSup(table=[273.15 + 19, 273.15 + 50;
                                          273.15 + 21, 273.15 + 21]) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Setpoint for supply water temperature&quot;</span>;
  <a href="Buildings_Controls_Continuous.html#Buildings.Controls.Continuous.LimPID"
>Buildings.Controls.Continuous.LimPID</a> conPIDRad(
    Td=1,
    controllerType=Modelica.Blocks.Types.SimpleController.PI,
    k=0.1,
    Ti=120) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Controller for valve in radiator loop&quot;</span>;
  <a href="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.ReaderTMY3"
>BoundaryConditions.WeatherData.ReaderTMY3</a> weaDat(
    filNam=&quot;modelica://Buildings/Resources/weatherdata/USA_IL_Chicago-OHare.Intl.AP.725300_TMY3.mos&quot;) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Weather data reader&quot;</span>;
  <a href="Buildings_BoundaryConditions_WeatherData.html#Buildings.BoundaryConditions.WeatherData.Bus"
>BoundaryConditions.WeatherData.Bus</a> weaBus;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sources.html#Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature"
>Modelica.Thermal.HeatTransfer.Sources.PrescribedTemperature</a> TOut <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Outside temperature&quot;</span>;

<span style="color: #006400; font-weight: normal; font-style: normal;">//-------------------------Step 2: State machine implementation-------------------------//</span>
  <a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Step"
>Modelica_StateGraph2.Step</a> allOff(
    nOut=1,
    initialStep=true,
    use_activePort=true,
    nIn=1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;System off&quot;</span>;
  <a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Modelica_StateGraph2.Transition</a> T1(use_conditionPort=true, delayedTransition=
        false);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.LessThreshold"
>Modelica.Blocks.Logical.LessThreshold</a> lessThreshold(threshold=273.15 + 19);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.LessThreshold"
>Modelica.Blocks.Logical.LessThreshold</a> lessThreshold1(threshold=273.15 + 16);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</a> and3;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.LessThreshold"
>Modelica.Blocks.Logical.LessThreshold</a> lessThreshold2(threshold=273.15 + 70) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Threshold for boiler control&quot;</span>;
  <a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Step"
>Modelica_StateGraph2.Step</a> boilerOn(
    nIn=1,
    use_activePort=true,
    nOut=1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Boiler is on&quot;</span>;
  <a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Modelica_StateGraph2.Transition</a> T2(
    use_conditionPort=true, delayedTransition=false);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.GreaterThreshold"
>Modelica.Blocks.Logical.GreaterThreshold</a> greThrBoi(threshold=273.15 + 90) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Threshold for boiler control&quot;</span>;
  <a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Modelica_StateGraph2.Transition</a> T3(use_conditionPort=true,
    delayedTransition=true,
    waitTime=10);
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.GreaterThreshold"
>Modelica.Blocks.Logical.GreaterThreshold</a> greThrTRoo(threshold=273.15 + 21) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Threshold for room temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.GreaterThreshold"
>Modelica.Blocks.Logical.GreaterThreshold</a> greThrTROut(threshold=273.15 + 17) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Threshold for room temperature&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.And"
>Modelica.Blocks.Logical.And</a> and1;
  <a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Transition"
>Modelica_StateGraph2.Transition</a> T4(use_conditionPort=true,
    delayedTransition=true,
    waitTime=10);
  <a href="../../msl/Modelica_StateGraph2%202.0.2/help/Modelica_StateGraph2.html#Modelica_StateGraph2.Step"
>Modelica_StateGraph2.Step</a> pumpsOn(
    nIn=2,
    use_activePort=false,
    nOut=2) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Pumps are on&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Logical.html#Modelica.Blocks.Logical.Not"
>Modelica.Blocks.Logical.Not</a> not1 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Negate output of hysteresis&quot;</span>;
<span style="color: #006400; font-weight: normal; font-style: normal;">//--------------------------------------------------------------------------------------//</span>

<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(theCon.port_b, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(preHea.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(heaCap.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(timTab.y[1], preHea.Q_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.port_b, rad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortCon, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.heatPortRad, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumRad.port_b, temSup.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_b, pumBoi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumBoi.port_b, spl1.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_2, spl.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_2, valRad.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_2, mix.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl1.port_3, valBoi.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valBoi.port_2, temRet.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRet.port_b, boi.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.port_a, preSou.ports[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix2.port_2, valBoi.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl4.port_2, mix2.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl2.port_2, spl4.port_1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(valRad.port_3, spl4.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(spl.port_3, mix2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_3, spl2.port_3);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(mix.port_2, pumRad.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rad.port_b, spl2.port_1);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad2.y, boi.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T, TSetSup.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TSetSup.y, conPIDRad.u_s);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSup.T, conPIDRad.u_m);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(weaDat.weaBus, weaBus);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(weaBus.TDryBul, TOut.T);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, theCon.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TOut.port, senTOut.port);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(allOff.outPort[1], T1.inPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T, lessThreshold.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(lessThreshold1.u, senTOut.T);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(lessThreshold.y, and3.u1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(lessThreshold1.y, and3.u2);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(T1.conditionPort, and3.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.T, lessThreshold2.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(lessThreshold2.y, T2.conditionPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(T2.outPort, boilerOn.inPort[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boi.T, greThrBoi.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boilerOn.outPort[1], T3.inPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(greThrBoi.y, T3.conditionPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(boilerOn.activePort, booToReaRad2.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRoo.T, greThrTRoo.u);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(senTOut.T, greThrTROut.u);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(greThrTRoo.y, and1.u1);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(greThrTROut.y, and1.u2);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(and1.y, T4.conditionPort);

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(T1.outPort, pumpsOn.inPort[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(allOff.activePort, not1.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not1.y, booToReaRad.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(not1.y, booToReaRad1.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(T3.outPort, pumpsOn.inPort[2]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(T4.outPort, allOff.inPort[1]);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumpsOn.outPort[1], T4.inPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(pumpsOn.outPort[2], T2.inPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(conPIDRad.y, valRad.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad.y, pumRad.m_flow_in);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(conPIDBoi.y, valBoi.y);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(booToReaRad1.y, pumBoi.m_flow_in);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(TSetBoiRet.y, conPIDBoi.u_s);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temRet.T, conPIDBoi.u_m);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>System7;
</div>
<hr>
<address>
<a href="http://www.3ds.com/">Automatically generated</a> Mon Jul 13 14:31:23 2015.
</address>
</body>
</html>
