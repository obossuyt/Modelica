<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Buildings.Fluid.MassExchangers</title>
<meta name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="&quot;Package with mass exchanger models&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial, sans-serif; }
.modelica, .modelica * { font-size: 9pt; font-family: Courier, monospace; white-space: pre; }
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address { font-weight: normal; }
td      { border: 1px solid #808080; vertical-align: top; }
th      { border: 1px solid #808080; vertical-align: top; font-weight: bold; }
table   { border: 1px solid #808080; border-collapse: collapse; }
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- begin header -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- end header -->

<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE MassExchangers<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="Buildings.Fluid.MassExchangers"></a><a href="Buildings_Fluid.html#Buildings.Fluid"
>Buildings.Fluid</a>.MassExchangers</h2>
<p>
<b>Package with mass exchanger models</b><br>
</p>
<h3>Information</h3>

This package contains models for mass exchangers.
For heat exchanger models with humidity transfer, see the package
<a href="Buildings_Fluid_HeatExchangers.html#Buildings.Fluid.HeatExchangers"
>
Buildings.Fluid.HeatExchangers</a>.

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons_VariantsPackage.html#Modelica.Icons.VariantsPackage"
>Modelica.Icons.VariantsPackage</a> (Icon for package containing variants).</p>
<h3>Package Content</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Package Content">
<tr>
<th>Name</th>
<th>Description</th>
</tr>
<tr>
<td><img src="Buildings.Fluid.MassExchaa4d623e75411fcaeenessS.png" alt="Buildings.Fluid.MassExchangers.ConstantEffectiveness" width="20" height="20" align="top">&nbsp;<a href="Buildings_Fluid_MassExchangers.html#Buildings.Fluid.MassExchangers.ConstantEffectiveness"
>ConstantEffectiveness</a>
</td>
<td>Heat and moisture exchanger with constant effectiveness</td>
</tr>
<tr>
<td><img src="Buildings.Fluid.MassExcha1e075cdb2b97de0aier_uS.png" alt="Buildings.Fluid.MassExchangers.Humidifier_u" width="20" height="20" align="top">&nbsp;<a href="Buildings_Fluid_MassExchangers.html#Buildings.Fluid.MassExchangers.Humidifier_u"
>Humidifier_u</a>
</td>
<td>Ideal humidifier or dehumidifier with prescribed water mass flow rate addition or subtraction</td>
</tr>
<tr>
<td><img src="Buildings.Fluid.MassExchangers.ExamplesS.png" alt="Buildings.Fluid.MassExchangers.Examples" width="20" height="20" align="top">&nbsp;<a href="Buildings_Fluid_MassExchangers_Examples.html#Buildings.Fluid.MassExchangers.Examples"
>Examples</a>
</td>
<td>Collection of models that illustrate model use and test models</td>
</tr>
</table>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE ConstantEffectiveness<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Fluid.MassExchaa4d623e75411fcaeenessI.png" alt="Buildings.Fluid.MassExchangers.ConstantEffectiveness" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Fluid.MassExchangers.ConstantEffectiveness"></a><a href="Buildings_Fluid_MassExchangers.html#Buildings.Fluid.MassExchangers"
>Buildings.Fluid.MassExchangers</a>.ConstantEffectiveness</h2>
<p>
<b>Heat and moisture exchanger with constant effectiveness</b>
<br>
<br><img src="Buildings.Fluid.MassExchaa4d623e75411fcaeenessD.png" alt="Buildings.Fluid.MassExchangers.ConstantEffectiveness">
</p>
<h3>Information</h3>

<p>
Model for a heat and moisture exchanger with constant effectiveness.
</p>
<p>
This model transfers heat and moisture in the amount of </p>
<pre>
  Q = epsS * Q_max,
  m = epsL * mWat_max,
</pre>
<p>
where <code>epsS</code> and <code>epsL</code> are constant effectiveness
for the sensible and latent heat transfer,
<code>Q_max</code> is the maximum heat that can be transferred and
<code>mWat_max</code> is the maximum moisture that can be transferred.
</p>
<p>
For a sensible heat exchanger, use
<a href="Buildings_Fluid_HeatExchangers.html#Buildings.Fluid.HeatExchangers.ConstantEffectiveness"
>
Buildings.Fluid.HeatExchangers.ConstantEffectiveness</a>
instead of this model.
</p>
<p>
This model can only be used with medium models that define the integer constant
<code>Water</code> which needs to be equal to the index of the water mass fraction
in the species vector.
</p>

<p>Extends from <a href="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.PartialEffectiveness"
>Buildings.Fluid.HeatExchangers.BaseClasses.PartialEffectiveness</a> (Partial model to implement heat exchangers based on effectiveness model).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package Medium1</td><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</a></td><td>Medium 1 in the component</td></tr>
<tr><td colspan="2">replaceable package Medium2</td><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</a></td><td>Medium 2 in the component</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q1_flow</td><td>epsS*QMax_flow</td><td>Heat transferred into the medium 1 [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>MassFlowRate</a></td><td>mWat1_flow</td><td>+mWat_flow</td><td>Moisture mass flow rate added to the medium 1 [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q2_flow</td><td>-Q1_flow</td><td>Heat transferred into the medium 2 [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>MassFlowRate</a></td><td>mWat2_flow</td><td>-mWat_flow</td><td>Moisture mass flow rate added to the medium 2 [kg/s]</td></tr>
<tr><td>Boolean</td><td>sensibleOnly1</td><td>false</td><td>Set to true if sensible exchange only for medium 1</td></tr>
<tr><td>Boolean</td><td>sensibleOnly2</td><td>false</td><td>Set to true if sensible exchange only for medium 2</td></tr>
<tr><td>Real</td><td>epsS</td><td>0.8</td><td>Sensible heat exchanger effectiveness</td></tr>
<tr><td>Real</td><td>epsL</td><td>0.8</td><td>Latent heat exchanger effectiveness</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Nominal condition</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m1_flow_nominal</td><td>&nbsp;</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m2_flow_nominal</td><td>&nbsp;</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</a></td><td>dp1_nominal</td><td>&nbsp;</td><td>Pressure difference [Pa]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</a></td><td>dp2_nominal</td><td>&nbsp;</td><td>Pressure difference [Pa]</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Initialization</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>MassFlowRate</a></td><td>m1_flow.start</td><td>0</td><td>Mass flow rate from port_a1 to port_b1 (m1_flow &gt; 0 is design flow direction) [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</a></td><td>dp1.start</td><td>0</td><td>Pressure difference between port_a1 and port_b1 [Pa]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>MassFlowRate</a></td><td>m2_flow.start</td><td>0</td><td>Mass flow rate from port_a2 to port_b2 (m2_flow &gt; 0 is design flow direction) [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</a></td><td>dp2.start</td><td>0</td><td>Pressure difference between port_a2 and port_b2 [Pa]</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Assumptions</b></td></tr>
<tr><td>Boolean</td><td>allowFlowReversal1</td><td>true</td><td>= true to allow flow reversal in medium 1, false restricts to design direction (port_a -&gt; port_b)</td></tr>
<tr><td>Boolean</td><td>allowFlowReversal2</td><td>true</td><td>= true to allow flow reversal in medium 2, false restricts to design direction (port_a -&gt; port_b)</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Advanced</b></td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Initialization</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.SpecificEnthalpy"
>SpecificEnthalpy</a></td><td>h_outflow_a1_start</td><td>Medium1.h_default</td><td>Start value for enthalpy flowing out of port a1 [J/kg]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.SpecificEnthalpy"
>SpecificEnthalpy</a></td><td>h_outflow_b1_start</td><td>Medium1.h_default</td><td>Start value for enthalpy flowing out of port b1 [J/kg]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.SpecificEnthalpy"
>SpecificEnthalpy</a></td><td>h_outflow_a2_start</td><td>Medium2.h_default</td><td>Start value for enthalpy flowing out of port a2 [J/kg]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.SpecificEnthalpy"
>SpecificEnthalpy</a></td><td>h_outflow_b2_start</td><td>Medium2.h_default</td><td>Start value for enthalpy flowing out of port b2 [J/kg]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>MassFlowRate</a></td><td>m1_flow_small</td><td>1E-4*abs(m1_flow_nominal)</td><td>Small mass flow rate for regularization of zero flow [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>MassFlowRate</a></td><td>m2_flow_small</td><td>1E-4*abs(m2_flow_nominal)</td><td>Small mass flow rate for regularization of zero flow [kg/s]</td></tr>
<tr><td>Boolean</td><td>homotopyInitialization</td><td>true</td><td>= true, use homotopy method</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Diagnostics</td></tr>
<tr><td>Boolean</td><td>show_T</td><td>false</td><td>= true, if actual temperature at port is computed</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Flow resistance</b></td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Medium 1</td></tr>
<tr><td>Boolean</td><td>from_dp1</td><td>false</td><td>= true, use m_flow = f(dp) else dp = f(m_flow)</td></tr>
<tr><td>Boolean</td><td>linearizeFlowResistance1</td><td>false</td><td>= true, use linear relation between m_flow and dp for any flow rate</td></tr>
<tr><td>Real</td><td>deltaM1</td><td>0.1</td><td>Fraction of nominal flow rate where flow transitions to laminar</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Medium 2</td></tr>
<tr><td>Boolean</td><td>from_dp2</td><td>false</td><td>= true, use m_flow = f(dp) else dp = f(m_flow)</td></tr>
<tr><td>Boolean</td><td>linearizeFlowResistance2</td><td>false</td><td>= true, use linear relation between m_flow and dp for any flow rate</td></tr>
<tr><td>Real</td><td>deltaM2</td><td>0.1</td><td>Fraction of nominal flow rate where flow transitions to laminar</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package Medium1</td><td>Medium 1 in the component</td></tr>
<tr><td colspan="2">replaceable package Medium2</td><td>Medium 2 in the component</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</a></td><td>port_a1</td><td>Fluid connector a1 (positive design flow direction is from port_a1 to port_b1)</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</a></td><td>port_b1</td><td>Fluid connector b1 (positive design flow direction is from port_a1 to port_b1)</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</a></td><td>port_a2</td><td>Fluid connector a2 (positive design flow direction is from port_a2 to port_b2)</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</a></td><td>port_b2</td><td>Fluid connector b2 (positive design flow direction is from port_a2 to port_b2)</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> ConstantEffectiveness <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;Heat and moisture exchanger with constant effectiveness&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.PartialEffectiveness"
>Buildings.Fluid.HeatExchangers.BaseClasses.PartialEffectiveness</a>(
  <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium1 = <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialCondensingGases.html#Modelica.Media.Interfaces.PartialCondensingGases"
>Modelica.Media.Interfaces.PartialCondensingGases</a>,
  <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium2 = <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialCondensingGases.html#Modelica.Media.Interfaces.PartialCondensingGases"
>Modelica.Media.Interfaces.PartialCondensingGases</a>,
  sensibleOnly1=false,
  sensibleOnly2=false,
  Q1_flow = epsS * QMax_flow,
  Q2_flow = -Q1_flow,
  mWat1_flow = +mWat_flow,
  mWat2_flow = -mWat_flow);

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Real epsS(min=0, max=1) = 0.8 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Sensible heat exchanger effectiveness&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Real epsL(min=0, max=1) = 0.8 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Latent heat exchanger effectiveness&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.MassFraction"
>Medium1.MassFraction</a> X_w_in1 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Inlet water mass fraction of medium 1&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.MassFraction"
>Medium2.MassFraction</a> X_w_in2 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Inlet water mass fraction of medium 2&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mWat_flow <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Water flow rate from medium 2 to medium 1&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mMax_flow <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Maximum water flow rate from medium 2 to medium 1&quot;</span>;

<span style="color: blue; font-weight: normal; font-style: normal;">protected </span>
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Integer i1_w(min=1, fixed=false) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Index for water substance&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Integer i2_w(min=1, fixed=false) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Index for water substance&quot;</span>;
  Real gai1(min=0, max=1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Auxiliary variable for smoothing at zero flow&quot;</span>;
  Real gai2(min=0, max=1) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Auxiliary variable for smoothing at zero flow&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">initial </span><span style="color: blue; font-weight: normal; font-style: normal;">algorithm </span>
  i1_w:= -1;
  i2_w:= -1;
  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>1:Medium1.nXi<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
      <span style="color: blue; font-weight: normal; font-style: normal;">if </span><span style="color: red; font-weight: normal; font-style: normal;">Modelica.Utilities.Strings.isEqual</span>(string1=Medium1.substanceNames[i],
                                            string2=&quot;Water&quot;,
                                            caseSensitive=false)<span style="color: blue; font-weight: normal; font-style: normal;"> then</span>
      i1_w := i;
    <span style="color: blue; font-weight: normal; font-style: normal;">end if</span>;
   <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>1:Medium2.nXi<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
      <span style="color: blue; font-weight: normal; font-style: normal;">if </span><span style="color: red; font-weight: normal; font-style: normal;">Modelica.Utilities.Strings.isEqual</span>(string1=Medium2.substanceNames[i],
                                            string2=&quot;Water&quot;,
                                            caseSensitive=false)<span style="color: blue; font-weight: normal; font-style: normal;"> then</span>
      i2_w := i;
    <span style="color: blue; font-weight: normal; font-style: normal;">end if</span>;
   <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;
  <span style="color: red; font-weight: normal; font-style: normal;">  assert</span>(i1_w &gt; 0, &quot;Substance &#39;water&#39; is not present in Medium1 &#39;&quot;
         + Medium1.mediumName + &quot;&#39;.\n&quot;
         + &quot;Check medium model.&quot;);
  <span style="color: red; font-weight: normal; font-style: normal;">  assert</span>(i2_w &gt; 0, &quot;Substance &#39;water&#39; is not present in Medium2 &#39;&quot;
         + Medium2.mediumName + &quot;&#39;.\n&quot;
         + &quot;Check medium model.&quot;);
<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: #006400; font-weight: normal; font-style: normal;">// Definitions for effectiveness model</span>
  X_w_in1 =<span style="color: red; font-weight: normal; font-style: normal;"> Modelica.Fluid.Utilities.regStep</span>(m1_flow,
                  state_a1_inflow.X[i1_w],
                  state_b1_inflow.X[i1_w], m1_flow_small);
  X_w_in2 =<span style="color: red; font-weight: normal; font-style: normal;"> Modelica.Fluid.Utilities.regStep</span>(m2_flow,
                  state_a2_inflow.X[i2_w],
                  state_b2_inflow.X[i2_w], m2_flow_small);

  <span style="color: #006400; font-weight: normal; font-style: normal;">// mass exchange</span>
  <span style="color: #006400; font-weight: normal; font-style: normal;">// Compute a gain that goes to zero near zero flow rate.</span>
  <span style="color: #006400; font-weight: normal; font-style: normal;">// This is required to smoothen the heat transfer at very small flow rates.</span>
  <span style="color: #006400; font-weight: normal; font-style: normal;">// Note that gaiK = 1 for abs(mK_flow) &gt; mK_flow_small</span>
  gai1 =<span style="color: red; font-weight: normal; font-style: normal;"> Modelica.Fluid.Utilities.regStep</span>(<span style="color: red; font-weight: normal; font-style: normal;">abs</span>(m1_flow) - 0.75*m1_flow_small,
              1, 0, 0.25*m1_flow_small);
  gai2 =<span style="color: red; font-weight: normal; font-style: normal;"> Modelica.Fluid.Utilities.regStep</span>(<span style="color: red; font-weight: normal; font-style: normal;">abs</span>(m2_flow) - 0.75*m2_flow_small,
              1, 0, 0.25*m2_flow_small);

  mMax_flow =<span style="color: red; font-weight: normal; font-style: normal;"> smooth</span>(1,<span style="color: red; font-weight: normal; font-style: normal;"> min</span>(<span style="color: red; font-weight: normal; font-style: normal;">smooth</span>(1, gai1 *<span style="color: red; font-weight: normal; font-style: normal;"> abs</span>(m1_flow)),
                            <span style="color: red; font-weight: normal; font-style: normal;">smooth</span>(1, gai2 *<span style="color: red; font-weight: normal; font-style: normal;"> abs</span>(m2_flow)))) * (X_w_in2 - X_w_in1);
  mWat_flow = epsL * mMax_flow;

<span style="color: blue; font-weight: normal; font-style: normal;">end </span>ConstantEffectiveness;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE Humidifier_u<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Fluid.MassExcha1e075cdb2b97de0aier_uI.png" alt="Buildings.Fluid.MassExchangers.Humidifier_u" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Fluid.MassExchangers.Humidifier_u"></a><a href="Buildings_Fluid_MassExchangers.html#Buildings.Fluid.MassExchangers"
>Buildings.Fluid.MassExchangers</a>.Humidifier_u</h2>
<p>
<b>Ideal humidifier or dehumidifier with prescribed water mass flow rate addition or subtraction</b>
<br>
<br><img src="Buildings.Fluid.MassExcha1e075cdb2b97de0aier_uD.png" alt="Buildings.Fluid.MassExchangers.Humidifier_u">
</p>
<h3>Information</h3>

<p>
Model for an air humidifier or dehumidifier.
</p>
<p>
This model adds (or removes) moisture from the air stream.
The amount of exchanged moisture is equal to
</p>
<p align="center" style="font-style:italic;">
m&#775;<sub>wat</sub> = u  m&#775;<sub>wat,nom</sub>,
</p>
<p>
where <i>u</i> is the control input signal and
<i>m&#775;<sub>wat,nom</sub></i> is equal to the parameter <code>mWat_flow_nominal</code>.
The parameter <code>mWat_flow_nominal</code> can be positive or negative.
If <i>m&#775;<sub>wat</sub></i> is positive, then moisture is added
to the air stream, otherwise it is removed.
</p>
<p>If the connector <code>T_in</code> is left unconnected, the value
set by the parameter <code>T</code> is used for the temperature of the water that is
added to the air stream.
</p>
<p>
This model can only be used with medium models that define the integer constant
<code>Water</code> which needs to be equal to the index of the water mass fraction
in the species vector.
</p>

<p>Extends from <a href="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.TwoPortHeatMassExchanger"
>Buildings.Fluid.Interfaces.TwoPortHeatMassExchanger</a> (Partial model transporting one fluid stream with storing mass or energy).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package Medium</td><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</a></td><td>Medium in the component</td></tr>
<tr><td>Boolean</td><td>use_T_in</td><td>false</td><td>Get the temperature from the input connector</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>T</td><td>293.15</td><td>Temperature of water that is added to the fluid stream (used if use_T_in=false) [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>mWat_flow_nominal</td><td>&nbsp;</td><td>Water mass flow rate at u=1, positive for humidification [kg/s]</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Nominal condition</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m_flow_nominal</td><td>&nbsp;</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</a></td><td>dp_nominal</td><td>&nbsp;</td><td>Pressure difference [Pa]</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Initialization</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m_flow.start</td><td>0</td><td>Mass flow rate from port_a to port_b (m_flow &gt; 0 is design flow direction) [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</a></td><td>dp.start</td><td>0</td><td>Pressure difference between port_a and port_b [Pa]</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Assumptions</b></td></tr>
<tr><td>Boolean</td><td>allowFlowReversal</td><td>true</td><td>= true to allow flow reversal, false restricts to design direction (port_a -&gt; port_b)</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Advanced</b></td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m_flow_small</td><td>1E-4*abs(m_flow_nominal)</td><td>Small mass flow rate for regularization of zero flow [kg/s]</td></tr>
<tr><td>Boolean</td><td>homotopyInitialization</td><td>true</td><td>= true, use homotopy method</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Diagnostics</td></tr>
<tr><td>Boolean</td><td>show_T</td><td>false</td><td>= true, if actual temperature at port is computed</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Flow resistance</b></td></tr>
<tr><td>Boolean</td><td>from_dp</td><td>false</td><td>= true, use m_flow = f(dp) else dp = f(m_flow)</td></tr>
<tr><td>Boolean</td><td>linearizeFlowResistance</td><td>false</td><td>= true, use linear relation between m_flow and dp for any flow rate</td></tr>
<tr><td>Real</td><td>deltaM</td><td>0.1</td><td>Fraction of nominal flow rate where flow transitions to laminar</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Dynamics</b></td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Nominal condition</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</a></td><td>tau</td><td>30</td><td>Time constant at nominal flow (if energyDynamics &lt;&gt; SteadyState) [s]</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Equations</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</a></td><td>energyDynamics</td><td>Modelica.Fluid.Types.Dynamic...</td><td>Formulation of energy balance</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</a></td><td>massDynamics</td><td>energyDynamics</td><td>Formulation of mass balance</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Initialization</b></td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.AbsolutePressure"
>AbsolutePressure</a></td><td>p_start</td><td>Medium.p_default</td><td>Start value of pressure [Pa]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.Temperature"
>Temperature</a></td><td>T_start</td><td>Medium.T_default</td><td>Start value of temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.MassFraction"
>MassFraction</a></td><td>X_start[Medium.nX]</td><td>Medium.X_default</td><td>Start value of mass fractions m_i/m [kg/kg]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.ExtraProperty"
>ExtraProperty</a></td><td>C_start[Medium.nC]</td><td>fill(0, Medium.nC)</td><td>Start value of trace substances</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package Medium</td><td>Medium in the component</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</a></td><td>port_a</td><td>Fluid connector a (positive design flow direction is from port_a to port_b)</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</a></td><td>port_b</td><td>Fluid connector b (positive design flow direction is from port_a to port_b)</td></tr>
<tr><td>input <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>T_in</td><td>Temperature of water added to the fluid stream</td></tr>
<tr><td>input <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>u</td><td>Control input</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> Humidifier_u <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;Ideal humidifier or dehumidifier with prescribed water mass flow rate addition or subtraction&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.TwoPortHeatMassExchanger"
>Buildings.Fluid.Interfaces.TwoPortHeatMassExchanger</a>(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =
        <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialCondensingGases.html#Modelica.Media.Interfaces.PartialCondensingGases"
>Modelica.Media.Interfaces.PartialCondensingGases</a>,
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span><a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolumeMoistAir"
>Buildings.Fluid.MixingVolumes.MixingVolumeMoistAir</a> vol(
      prescribedHeatFlowRate=true));

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Boolean use_T_in= false <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Get the temperature from the input connector&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> T = 293.15 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature of water that is added to the fluid stream (used if use_T_in=false)&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> mWat_flow_nominal <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Water mass flow rate at u=1, positive for humidification&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> T_in <span style="color: blue; font-weight: normal; font-style: normal;">if </span>use_T_in <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature of water added to the fluid stream&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> u <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Control input&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">protected </span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> T_in_internal <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Needed to connect to conditional connector&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Math.html#Modelica.Blocks.Math.Gain"
>Modelica.Blocks.Math.Gain</a> gai(k=mWat_flow_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Gain&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.RealExpression"
>Modelica.Blocks.Sources.RealExpression</a> TWat(y=T_in_internal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature of the water&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: #006400; font-weight: normal; font-style: normal;">// Conditional connect statement</span>
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(T_in, T_in_internal);
  <span style="color: blue; font-weight: normal; font-style: normal;">if </span><span style="color: blue; font-weight: normal; font-style: normal;">not </span>use_T_in<span style="color: blue; font-weight: normal; font-style: normal;"> then</span>
    T_in_internal = T;
  <span style="color: blue; font-weight: normal; font-style: normal;">end if</span>;

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(u, gai.u);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(gai.y, vol.mWat_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(vol.TWat, TWat.y);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>Humidifier_u;
</div>
<hr>
<address>
<a href="http://www.3ds.com/">Automatically generated</a> Mon Jul 13 14:25:36 2015.
</address>
</body>
</html>
