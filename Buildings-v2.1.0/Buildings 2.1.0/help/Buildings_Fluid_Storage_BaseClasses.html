<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Buildings.Fluid.Storage.BaseClasses</title>
<meta name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="&quot;Package with base classes for Buildings.Fluid.Storage&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial, sans-serif; }
.modelica, .modelica * { font-size: 9pt; font-family: Courier, monospace; white-space: pre; }
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address { font-weight: normal; }
td      { border: 1px solid #808080; vertical-align: top; }
th      { border: 1px solid #808080; vertical-align: top; font-weight: bold; }
table   { border: 1px solid #808080; border-collapse: collapse; }
</style>
<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../Resources/www/modelicaDoc.css">
</HEAD>
<body>
<!-- begin header -->
<div class="headerStyle">
<img src="../Resources/www/lbl-logo.png" alt="LBL logo"/>
</div>
<div class="headerLinks">
<ul><li><a href="http://simulationresearch.lbl.gov/modelica">Home</a> &gt; <a href="Buildings.html">Modelica</a></li></ul>
</div>
<!-- end header -->

<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE BaseClasses<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><a name="Buildings.Fluid.Storage.BaseClasses"></a><a href="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage"
>Buildings.Fluid.Storage</a>.BaseClasses</h2>
<p>
<b>Package with base classes for Buildings.Fluid.Storage</b><br>
</p>
<h3>Information</h3>

<p>
This package contains base classes that are used to construct the models in
<a href="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage"
>Buildings.Fluid.Storage</a>.
</p>

<p>Extends from <a href="../../msl/Modelica%203.2.1/help/Modelica_Icons_BasesPackage.html#Modelica.Icons.BasesPackage"
>Modelica.Icons.BasesPackage</a> (Icon for packages containing base classes).</p>
<h3>Package Content</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Package Content">
<tr>
<th>Name</th>
<th>Description</th>
</tr>
<tr>
<td><img src="Buildings.Fluid.Storage.Ba59ec09b42b7c4dbyancyS.png" alt="Buildings.Fluid.Storage.BaseClasses.Buoyancy" width="20" height="20" align="top">&nbsp;<a href="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.Buoyancy"
>Buoyancy</a>
</td>
<td>Model to add buoyancy if there is a temperature inversion in the tank</td>
</tr>
<tr>
<td><img src="Buildings.Fluid.Storage.B98092f341fff4c2amplesS.png" alt="Buildings.Fluid.Storage.BaseClasses.Examples" width="20" height="20" align="top">&nbsp;<a href="Buildings_Fluid_Storage_BaseClasses_Examples.html#Buildings.Fluid.Storage.BaseClasses.Examples"
>Examples</a>
</td>
<td>Examples for BaseClasses models</td>
</tr>
<tr>
<td><img src="Buildings.Fluid.Storage.B081e0484b44bf295angerS.png" alt="Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger" width="20" height="20" align="top">&nbsp;<a href="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger"
>IndirectTankHeatExchanger</a>
</td>
<td>Heat exchanger typically submerged in a fluid with a second fluid circulating through it</td>
</tr>
<tr>
<td><img src="Buildings.Fluid.Storage.Bd25479539900e37fifierS.png" alt="Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier" width="20" height="20" align="top">&nbsp;<a href="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier"
>ThirdOrderStratifier</a>
</td>
<td>Model to reduce the numerical dissipation in a tank</td>
</tr>
</table>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE Buoyancy<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Fluid.Storage.Ba59ec09b42b7c4dbyancyI.png" alt="Buildings.Fluid.Storage.BaseClasses.Buoyancy" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Fluid.Storage.BaseClasses.Buoyancy"></a><a href="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses"
>Buildings.Fluid.Storage.BaseClasses</a>.Buoyancy</h2>
<p>
<b>Model to add buoyancy if there is a temperature inversion in the tank</b>
<br>
<br><img src="Buildings.Fluid.Storage.Ba59ec09b42b7c4dbyancyD.png" alt="Buildings.Fluid.Storage.BaseClasses.Buoyancy">
</p>
<h3>Information</h3>

<p>
This model outputs a heat flow rate that can be added to fluid volumes
in order to emulate buoyancy during a temperature inversion.
For simplicity, this model does not compute a buoyancy induced mass flow rate,
but rather a heat flow that has the same magnitude as the enthalpy flow
associated with the buoyancy induced mass flow rate.
</p>

<p>Extends from <a href="Buildings_BaseClasses.html#Buildings.BaseClasses.BaseIcon"
>Buildings.BaseClasses.BaseIcon</a> (Base icon).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package Medium</td><td>Modelica.Media.Interfaces.Pa...</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>V</td><td>&nbsp;</td><td>Volume [m3]</td></tr>
<tr><td>Integer</td><td>nSeg</td><td>2</td><td>Number of volume segments</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</a></td><td>tau</td><td>&nbsp;</td><td>Time constant for mixing [s]</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package Medium</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</a></td><td>heatPort[nSeg]</td><td>Heat input into the volumes</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> Buoyancy <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;Model to add buoyancy if there is a temperature inversion in the tank&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="Buildings_BaseClasses.html#Buildings.BaseClasses.BaseIcon"
>Buildings.BaseClasses.BaseIcon</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium =
    <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</a> <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Medium model&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> V <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Volume&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Integer nSeg(min=2) = 2 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Number of volume segments&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</a> tau(min=0) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Time constant for mixing&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</a>[nSeg] heatPort <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat input into the volumes&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a>[nSeg-1] Q_flow <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat flow rate from segment i+1 to i&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">protected </span>
   <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ThermodynamicState"
>Medium.ThermodynamicState</a> sta_default =<span style="color: red; font-weight: normal; font-style: normal;"> Medium.setState_pTX</span>(T=Medium.T_default,
         p=Medium.p_default, X=Medium.X_default[1:Medium.nXi]) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Medium state at default properties&quot;</span>;
   <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Density"
>Modelica.SIunits.Density</a> rho_default=<span style="color: red; font-weight: normal; font-style: normal;">Medium.density</span>(sta_default) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Density, used to compute fluid mass&quot;</span>;
   <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.SpecificHeatCapacity"
>Modelica.SIunits.SpecificHeatCapacity</a> cp_default=<span style="color: red; font-weight: normal; font-style: normal;">Medium.specificHeatCapacityCp</span>(sta_default) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Specific heat capacity&quot;</span>;
   <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Real k(unit=&quot;W/K&quot;) = V*rho_default*cp_default/tau/nSeg <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Proportionality constant, since we use dT instead of dH&quot;</span>;
   <a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.TemperatureDifference"
>Modelica.SIunits.TemperatureDifference</a> dT[nSeg-1] <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature difference between adjoining volumes&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>1:nSeg-1<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
    dT[i] = heatPort[i+1].T-heatPort[i].T;
    Q_flow[i] = k*<span style="color: red; font-weight: normal; font-style: normal;">noEvent</span>(<span style="color: red; font-weight: normal; font-style: normal;">smooth</span>(1, <span style="color: blue; font-weight: normal; font-style: normal;">if </span>dT[i]&gt;0<span style="color: blue; font-weight: normal; font-style: normal;"> then </span>dT[i]^2<span style="color: blue; font-weight: normal; font-style: normal;"> else </span>0));
  <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;

  heatPort[1].Q_flow = -Q_flow[1];
  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>2:nSeg-1<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
       heatPort[i].Q_flow = -Q_flow[i]+Q_flow[i-1];
  <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;
  heatPort[nSeg].Q_flow = Q_flow[nSeg-1];
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>Buoyancy;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE IndirectTankHeatExchanger<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Fluid.Storage.B081e0484b44bf295angerI.png" alt="Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger"></a><a href="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses"
>Buildings.Fluid.Storage.BaseClasses</a>.IndirectTankHeatExchanger</h2>
<p>
<b>Heat exchanger typically submerged in a fluid with a second fluid circulating through it</b>
<br>
<br><img src="Buildings.Fluid.Storage.B081e0484b44bf295angerD.png" alt="Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger">
</p>
<h3>Information</h3>

          <p>
          This model is a heat exchanger with a moving fluid on one side and a stagnant fluid on the other.
          It is intended for use when a heat exchanger is submerged in a stagnant fluid.
          For example, the heat exchanger in a storage tank which is part of a solar thermal system.
          </p>
          <p>
          This component models the fluid in the heat exchanger, convection between the fluid and
          the heat exchanger, and convection from the heat exchanger to the surrounding fluid.
          </p>
          <p>
          The model is based on <a href="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.HACoilInside"
>
          Buildings.Fluid.HeatExchangers.BaseClasses.HACoilInside</a> and
          <a href="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.HANaturalCylinder"
>
          Buildings.Fluid.HeatExchangers.BaseClasses.HANaturalCylinder</a>.
          </p>
          <p>
          The fluid ports are intended to be connected to a circulated heat transfer fluid
          while the heat port is intended to be connected to a stagnant fluid.
          </p>
          
<p>Extends from <a href="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.TwoPortFlowResistanceParameters"
>Buildings.Fluid.Interfaces.TwoPortFlowResistanceParameters</a> (Parameters for flow resistance for models with two ports), <a href="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.LumpedVolumeDeclarations"
>Buildings.Fluid.Interfaces.LumpedVolumeDeclarations</a> (Declarations for lumped volumes), <a href="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.PartialTwoPortInterface"
>Buildings.Fluid.Interfaces.PartialTwoPortInterface</a> (Partial model transporting fluid between two ports without storing mass or energy).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumHex</td><td>Modelica.Media.Interfaces.Pa...</td><td>Heat transfer fluid flowing through the heat exchanger</td></tr>
<tr><td colspan="2">replaceable package MediumTan</td><td>Modelica.Media.Interfaces.Pa...</td><td>Heat transfer fluid inside the tank</td></tr>
<tr><td colspan="2">replaceable package Medium</td><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</a></td><td>Medium in the component</td></tr>
<tr><td>Integer</td><td>nSeg</td><td>&nbsp;</td><td>Number of segments in the heat exchanger</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatCapacity"
>HeatCapacity</a></td><td>CHex</td><td>&nbsp;</td><td>Capacitance of the heat exchanger [J/K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</a></td><td>volHexFlu</td><td>&nbsp;</td><td>Volume of heat transfer fluid in the heat exchanger [m3]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Diameter"
>Diameter</a></td><td>dExtHex</td><td>&nbsp;</td><td>Exterior diameter of the heat exchanger pipe [m]</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Nominal condition</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</a></td><td>dp_nominal</td><td>&nbsp;</td><td>Pressure difference [Pa]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m_flow_nominal</td><td>&nbsp;</td><td>Nominal mass flow rate [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>HeatFlowRate</a></td><td>Q_flow_nominal</td><td>&nbsp;</td><td>Heat transfer at nominal conditions [W]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>TTan_nominal</td><td>&nbsp;</td><td>Temperature of fluid inside the tank at UA_nominal [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</a></td><td>THex_nominal</td><td>&nbsp;</td><td>Temperature of fluid inside the heat exchanger at UA_nominal [K]</td></tr>
<tr><td>Real</td><td>r_nominal</td><td>0.5</td><td>Ratio between coil inside and outside convective heat transfer</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Initialization</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m_flow.start</td><td>0</td><td>Mass flow rate from port_a to port_b (m_flow &gt; 0 is design flow direction) [kg/s]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Pressure"
>Pressure</a></td><td>dp.start</td><td>0</td><td>Pressure difference between port_a and port_b [Pa]</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Flow resistance</b></td></tr>
<tr><td>Boolean</td><td>computeFlowResistance</td><td>true</td><td>=true, compute flow resistance. Set to false to assume no friction</td></tr>
<tr><td>Boolean</td><td>from_dp</td><td>false</td><td>= true, use m_flow = f(dp) else dp = f(m_flow)</td></tr>
<tr><td>Boolean</td><td>linearizeFlowResistance</td><td>false</td><td>= true, use linear relation between m_flow and dp for any flow rate</td></tr>
<tr><td>Real</td><td>deltaM</td><td>0.1</td><td>Fraction of nominal flow rate where flow transitions to laminar</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Dynamics</b></td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Equations</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</a></td><td>energyDynamics</td><td>Modelica.Fluid.Types.Dynamic...</td><td>Formulation of energy balance</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</a></td><td>massDynamics</td><td>energyDynamics</td><td>Formulation of mass balance</td></tr>
<tr><td>Real</td><td>mSenFac</td><td>1</td><td>Factor for scaling the sensible thermal mass of the volume</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Initialization</b></td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.AbsolutePressure"
>AbsolutePressure</a></td><td>p_start</td><td>Medium.p_default</td><td>Start value of pressure [Pa]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.Temperature"
>Temperature</a></td><td>T_start</td><td>Medium.T_default</td><td>Start value of temperature [K]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.MassFraction"
>MassFraction</a></td><td>X_start[Medium.nX]</td><td>Medium.X_default</td><td>Start value of mass fractions m_i/m [kg/kg]</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.ExtraProperty"
>ExtraProperty</a></td><td>C_start[Medium.nC]</td><td>fill(0, Medium.nC)</td><td>Start value of trace substances</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_Types.html#Modelica.Media.Interfaces.Types.ExtraProperty"
>ExtraProperty</a></td><td>C_nominal[Medium.nC]</td><td>fill(1E-2, Medium.nC)</td><td>Nominal value of trace substances. (Set to typical order of magnitude.)</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Assumptions</b></td></tr>
<tr><td>Boolean</td><td>allowFlowReversal</td><td>true</td><td>= true to allow flow reversal, false restricts to design direction (port_a -&gt; port_b)</td></tr>
<tr style="background-color: #c0c0c0"><td colspan="4"><b>Advanced</b></td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m_flow_small</td><td>1E-4*abs(m_flow_nominal)</td><td>Small mass flow rate for regularization of zero flow [kg/s]</td></tr>
<tr><td>Boolean</td><td>homotopyInitialization</td><td>true</td><td>= true, use homotopy method</td></tr>
<tr style="background-color: #e0e0e0"><td colspan="4">Diagnostics</td></tr>
<tr><td>Boolean</td><td>show_T</td><td>false</td><td>= true, if actual temperature at port is computed</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package MediumHex</td><td>Heat transfer fluid flowing through the heat exchanger</td></tr>
<tr><td colspan="2">replaceable package MediumTan</td><td>Heat transfer fluid inside the tank</td></tr>
<tr><td colspan="2">replaceable package Medium</td><td>Medium in the component</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</a></td><td>port_a</td><td>Fluid connector a (positive design flow direction is from port_a to port_b)</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</a></td><td>port_b</td><td>Fluid connector b (positive design flow direction is from port_a to port_b)</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</a></td><td>port[nSeg]</td><td>Heat port connected to water inside the tank</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> IndirectTankHeatExchanger <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;Heat exchanger typically submerged in a fluid with a second fluid circulating through it&quot;</span>

  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumHex = <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</a> <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat transfer fluid flowing through the heat exchanger&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> MediumTan = <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</a> <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat transfer fluid inside the tank&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.TwoPortFlowResistanceParameters"
>Buildings.Fluid.Interfaces.TwoPortFlowResistanceParameters</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.LumpedVolumeDeclarations"
>Buildings.Fluid.Interfaces.LumpedVolumeDeclarations</a>(
      <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Fluid_Storage_BaseClasses_MediumHex.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger.MediumHex"
>MediumHex</a>);
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="Buildings_Fluid_Interfaces.html#Buildings.Fluid.Interfaces.PartialTwoPortInterface"
>Buildings.Fluid.Interfaces.PartialTwoPortInterface</a>(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Fluid_Storage_BaseClasses_MediumHex.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger.MediumHex"
>MediumHex</a>,
    showDesignFlowDirection=false,
    <span style="color: blue; font-weight: normal; font-style: normal;">final </span>show_T=false);

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Integer nSeg(min=2) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Number of segments in the heat exchanger&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatCapacity"
>Modelica.SIunits.HeatCapacity</a> CHex <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Capacitance of the heat exchanger&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Volume"
>Modelica.SIunits.Volume</a> volHexFlu <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Volume of heat transfer fluid in the heat exchanger&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> Q_flow_nominal <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat transfer at nominal conditions&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">final </span><span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.ThermalConductance"
>Modelica.SIunits.ThermalConductance</a> UA_nominal=
    <span style="color: red; font-weight: normal; font-style: normal;">abs</span>(Q_flow_nominal/(THex_nominal-TTan_nominal)) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Nominal UA value for the heat exchanger&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> TTan_nominal <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature of fluid inside the tank at UA_nominal&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Modelica.SIunits.Temperature</a> THex_nominal <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature of fluid inside the heat exchanger at UA_nominal&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Real r_nominal(min=0, max=1)=0.5 <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Ratio between coil inside and outside convective heat transfer&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.Diameter"
>Modelica.SIunits.Diameter</a> dExtHex <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Exterior diameter of the heat exchanger pipe&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Modelica.Fluid.Types.Dynamics</a> energyDynamics=Modelica.Fluid.Types.Dynamics.DynamicFreeInitial <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Formulation of energy balance&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Modelica.Fluid.Types.Dynamics</a> massDynamics=energyDynamics <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Formulation of mass balance&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Boolean homotopyInitialization = true <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;= true, use homotopy method&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</a> port[nSeg] <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat port connected to water inside the tank&quot;</span>;

  <a href="Buildings_Fluid_FixedResistances.html#Buildings.Fluid.FixedResistances.FixedResistanceDpM"
>FixedResistances.FixedResistanceDpM</a> res(
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Fluid_Storage_BaseClasses_MediumHex.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger.MediumHex"
>MediumHex</a>,
    <span style="color: blue; font-weight: normal; font-style: normal;">final </span>dp_nominal=dp_nominal,
    <span style="color: blue; font-weight: normal; font-style: normal;">final </span>m_flow_nominal=m_flow_nominal,
    <span style="color: blue; font-weight: normal; font-style: normal;">final </span>allowFlowReversal=allowFlowReversal,
    <span style="color: blue; font-weight: normal; font-style: normal;">final </span>homotopyInitialization=homotopyInitialization,
    <span style="color: blue; font-weight: normal; font-style: normal;">final </span>show_T=show_T,
    <span style="color: blue; font-weight: normal; font-style: normal;">final </span>from_dp=from_dp,
    <span style="color: blue; font-weight: normal; font-style: normal;">final </span>linearized=linearizeFlowResistance) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Calculates the flow resistance and pressure drop through the heat exchanger&quot;</span>;

  <a href="Buildings_Fluid_MixingVolumes.html#Buildings.Fluid.MixingVolumes.MixingVolume"
>MixingVolumes.MixingVolume</a> vol[nSeg](<span style="color: blue; font-weight: normal; font-style: normal;">each </span>nPorts=2,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>m_flow_nominal=m_flow_nominal,
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">each </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Fluid_Storage_BaseClasses_MediumHex.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger.MediumHex"
>MediumHex</a>,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>V=volHexFlu/nSeg,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>energyDynamics=energyDynamics,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>massDynamics=massDynamics,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>p_start=p_start,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>T_start=T_start,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>X_start=X_start,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>C_start=C_start,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>C_nominal=C_nominal,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span>allowFlowReversal=allowFlowReversal) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Heat exchanger fluid&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.HeatCapacitor"
>Modelica.Thermal.HeatTransfer.Components.HeatCapacitor</a> cap[nSeg](<span style="color: blue; font-weight: normal; font-style: normal;">each </span>C=CHex/
        nSeg,
        T(<span style="color: blue; font-weight: normal; font-style: normal;">each </span>start=T_start,
          <span style="color: blue; font-weight: normal; font-style: normal;">each </span>fixed=(energyDynamics == Modelica.Fluid.Types.Dynamics.FixedInitial)),
        der_T(
          <span style="color: blue; font-weight: normal; font-style: normal;">each </span>fixed=(energyDynamics == Modelica.Fluid.Types.Dynamics.SteadyStateInitial))) <span style="color: blue; font-weight: normal; font-style: normal;">if </span>
        <span style="color: blue; font-weight: normal; font-style: normal;">not </span>(energyDynamics == Modelica.Fluid.Types.Dynamics.SteadyState) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Thermal mass of the heat exchanger&quot;</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">protected </span>
  <a href="Buildings_Fluid_Sensors.html#Buildings.Fluid.Sensors.MassFlowRate"
>Sensors.MassFlowRate</a> senMasFlo(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Fluid_Storage_BaseClasses_MediumHex.html#Buildings.Fluid.Storage.BaseClasses.IndirectTankHeatExchanger.MediumHex"
>MediumHex</a>,
      allowFlowReversal=allowFlowReversal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Mass flow rate of the heat transfer fluid&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.Convection"
>Modelica.Thermal.HeatTransfer.Components.Convection</a> htfToHex[nSeg] <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Convection coefficient between the heat transfer fluid and heat exchanger&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Components.html#Modelica.Thermal.HeatTransfer.Components.Convection"
>Modelica.Thermal.HeatTransfer.Components.Convection</a> HexToTan[nSeg] <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Convection coefficient between the heat exchanger and the surrounding medium&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a>
                                     temSenHex[nSeg] <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature of the heat transfer fluid&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> temSenWat[nSeg] <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature sensor of the fluid surrounding the heat exchanger&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Routing.html#Modelica.Blocks.Routing.Replicator"
>Modelica.Blocks.Routing.Replicator</a> rep(nout=nSeg) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Replicates senMasFlo signal from 1 seg to nSeg&quot;</span>;
  <a href="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.HACoilInside"
>HeatExchangers.BaseClasses.HACoilInside</a> hAPipIns[nSeg](
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>m_flow_nominal=m_flow_nominal,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>hA_nominal=UA_nominal/nSeg*(r_nominal + 1)/r_nominal,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span>T_nominal=THex_nominal) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Computation of convection coefficients inside the coil&quot;</span>;
  <a href="Buildings_Fluid_HeatExchangers_BaseClasses.html#Buildings.Fluid.HeatExchangers.BaseClasses.HANaturalCylinder"
>HeatExchangers.BaseClasses.HANaturalCylinder</a> hANatCyl[nSeg](
    <span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">each </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="Buildings_Fluid_Interfaces_Medium.html#Buildings.Fluid.Interfaces.LumpedVolumeDeclarations.Medium"
>Medium</a>,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span>ChaLen=dExtHex,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span>hA_nominal=UA_nominal/nSeg*(1 + r_nominal),
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span>TFlu_nominal=TTan_nominal,
    <span style="color: blue; font-weight: normal; font-style: normal;">each </span><span style="color: blue; font-weight: normal; font-style: normal;">final </span>TSur_nominal=TTan_nominal-(r_nominal/(1+r_nominal))*(TTan_nominal-THex_nominal)) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Calculates an hA value for each side of the heat exchanger&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Sensors.html#Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor"
>Modelica.Thermal.HeatTransfer.Sensors.TemperatureSensor</a> temSenSur[nSeg] <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Temperature at the external surface of the heat exchanger&quot;</span>;

<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>1:(nSeg - 1)<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
    <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(vol[i].ports[2], vol[i + 1].ports[1]);
  <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;

  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rep.u,senMasFlo. m_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(port,HexToTan. fluid);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(vol[1].ports[1],senMasFlo.port_b);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(cap.port,HexToTan.solid);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(vol.heatPort,htfToHex. fluid);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(htfToHex.solid,HexToTan. solid);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSenHex.T, hAPipIns.T);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hAPipIns.hA, htfToHex.Gc);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(HexToTan.solid,temSenSur. port);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSenWat.port, port);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSenSur.T, hANatCyl.TSur);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hANatCyl.TFlu, temSenWat.T);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(port_a, senMasFlo.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(vol[nSeg].ports[2], res.port_a);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(res.port_b, port_b);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(temSenHex.port, vol.heatPort);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(rep.y, hAPipIns.m_flow);
  <span style="color: red; font-weight: normal; font-style: normal;">connect</span>(hANatCyl.hA,HexToTan. Gc);
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>IndirectTankHeatExchanger;
</div>
<hr>
<!--[if supportFields]><span style="mso-element:field-begin"></span>
<span style="mso-spacerun:yes"></span>XE ThirdOrderStratifier<![endif]-->
<!--[if supportFields]><span style="mso-element:field-end"></span><![endif]-->
<h2><img src="Buildings.Fluid.Storage.Bd25479539900e37fifierI.png" alt="Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier" align="right" style="border: 1px solid" width="80" height="80">
<a name="Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier"></a><a href="Buildings_Fluid_Storage_BaseClasses.html#Buildings.Fluid.Storage.BaseClasses"
>Buildings.Fluid.Storage.BaseClasses</a>.ThirdOrderStratifier</h2>
<p>
<b>Model to reduce the numerical dissipation in a tank</b>
<br>
<br><img src="Buildings.Fluid.Storage.Bd25479539900e37fifierD.png" alt="Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier">
</p>
<h3>Information</h3>

<p>
This model reduces the numerical dissipation that is introduced
by the standard first-order upwind discretization scheme which is
created when connecting fluid volumes in series.
</p>
<p>
The model is used in conjunction with
<a href="modelica://Modelica.Fluid.Storage.Stratified">
Modelica.Fluid.Storage.Stratified</a>.
It computes a heat flux that needs to be added to each volume of <a href="modelica://Modelica.Fluid.Storage.Stratified">
Modelica.Fluid.Storage.Stratified</a> in order to give the results that a third-order upwind discretization scheme (QUICK) would give.
</p>
<p>
The QUICK method can cause oscillations in the tank temperatures since the high order method introduces numerical dispersion.
There are two ways to reduce the oscillations:</p>
<ul>
<li>
To use an under-relaxation coefficient <code>alpha</code> when adding the heat flux into the volume.
</li>
<li>
To use the first-order upwind for <code>hOut[2]</code> and <code>hOut[nSeg]</code>. Note: Using it requires <code>nSeg>=4</code>.
</li>
</ul>
<p>
Both approaches are implemented in the model.
</p>
<p>
The model is used by
<a href="Buildings_Fluid_Storage.html#Buildings.Fluid.Storage.StratifiedEnhanced"
>
Buildings.Fluid.Storage.StratifiedEnhanced</a>.
</p>
<h4>Limitations</h4>
<p>
The model requires at least 4 fluid segments. Hence, set <code>nSeg</code> to 4 or higher.
</p>

<p>Extends from <a href="Buildings_BaseClasses.html#Buildings.BaseClasses.BaseIcon"
>Buildings.BaseClasses.BaseIcon</a> (Base icon).</p>
<h3>Parameters</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Parameters">
<tr><th>Type</th><th>Name</th><th>Default</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package Medium</td><td>Modelica.Media.Interfaces.Pa...</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</a></td><td>m_flow_small</td><td>&nbsp;</td><td>Small mass flow rate for regularization of zero flow [kg/s]</td></tr>
<tr><td>Integer</td><td>nSeg</td><td>&nbsp;</td><td>Number of volume segments</td></tr>
<tr><td>Real</td><td>alpha</td><td>0.5</td><td>Under-relaxation coefficient (1: QUICK; 0: 1st order upwind)</td></tr>
</table>
<h3>Connectors</h3>
<table border="1" cellspacing="0" cellpadding="2" summary="Connectors">
<tr><th>Type</th><th>Name</th><th>Description</th></tr>
<tr><td colspan="2">replaceable package Medium</td><td>Medium model</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</a></td><td>heatPort[nSeg]</td><td>Heat input into the volumes</td></tr>
<tr><td>input <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>m_flow</td><td>Mass flow rate from port a to port b</td></tr>
<tr><td>input <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</a></td><td>H_flow[nSeg + 1]</td><td>Enthalpy flow between the volumes</td></tr>
<tr><td><a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</a></td><td>fluidPort[nSeg + 2]</td><td>Fluid port, needed to get pressure, temperature and species concentration</td></tr>
</table>
<h3>Modelica definition</h3>
<div class="modelica"><span style="color: blue; font-weight: normal; font-style: normal;">model</span> ThirdOrderStratifier <span style="color: #006400; font-weight: normal; font-style: normal;">
  &quot;Model to reduce the numerical dissipation in a tank&quot;</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">extends </span><a href="Buildings_BaseClasses.html#Buildings.BaseClasses.BaseIcon"
>Buildings.BaseClasses.BaseIcon</a>;
  <span style="color: blue; font-weight: normal; font-style: normal;">replaceable </span><span style="color: blue; font-weight: normal; font-style: normal;">package</span> Medium = <a href="../../msl/Modelica%203.2.1/help/Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</a> <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Medium model&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span><a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>Modelica.SIunits.MassFlowRate</a> m_flow_small(min=0) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Small mass flow rate for regularization of zero flow&quot;</span>;
  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Integer nSeg(min=4) <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Number of volume segments&quot;</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">parameter </span>Real alpha(
    min=0,
    max=1) = 0.5 <span style="color: #006400; font-weight: normal; font-style: normal;">&quot;Under-relaxation coefficient (1: QUICK; 0: 1st order upwind)&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</a>[nSeg] heatPort <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat input into the volumes&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a> m_flow <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Mass flow rate from port a to port b&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</a>[nSeg + 1] H_flow <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Enthalpy flow between the volumes&quot;</span>;

  <a href="../../msl/Modelica%203.2.1/help/Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>Modelica.Fluid.Interfaces.FluidPort_a</a>[nSeg + 2] fluidPort(<span style="color: blue; font-weight: normal; font-style: normal;">redeclare </span><span style="color: blue; font-weight: normal; font-style: normal;">each </span><span style="color: blue; font-weight: normal; font-style: normal;">
      package</span> Medium = <a href="Buildings_Fluid_Storage_BaseClasses_Medium.html#Buildings.Fluid.Storage.BaseClasses.ThirdOrderStratifier.Medium"
>Medium</a>) <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Fluid port, needed to get pressure, temperature and species concentration&quot;</span>;

<span style="color: blue; font-weight: normal; font-style: normal;">protected </span>
  <a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.SpecificEnthalpy"
>Modelica.SIunits.SpecificEnthalpy</a>[nSeg + 1] hOut <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Extended vector with new outlet enthalpies to reduce numerical dissipation (at the boundary between two volumes)&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.SpecificEnthalpy"
>Modelica.SIunits.SpecificEnthalpy</a>[nSeg + 2] h <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Extended vector with port enthalpies, needed to simplify loop&quot;</span>;
  <a href="../../msl/Modelica%203.2.1/help/Modelica_SIunits.html#Modelica.SIunits.HeatFlowRate"
>Modelica.SIunits.HeatFlowRate</a> Q_flow[nSeg] <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Heat exchange computed using upwind third order discretization scheme&quot;</span>;
  <span style="color: #006400; font-weight: normal; font-style: normal;">//    Modelica.SIunits.HeatFlowRate Q_flow_upWind</span>
  <span style="color: #006400; font-weight: normal; font-style: normal;">//     &quot;Heat exchange computed using upwind third order discretization scheme&quot;; //Used to test the energy conservation</span>
  Real sig <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Sign used to implement the third order upwind scheme without triggering a state event&quot;</span>;
  Real comSig <span style="color: #006400; font-weight: normal; font-style: normal;">
    &quot;Sign used to implement the third order upwind scheme without triggering a state event&quot;</span>;

<span style="color: blue; font-weight: normal; font-style: normal;">equation </span>
  <span style="color: red; font-weight: normal; font-style: normal;">assert</span>(nSeg &gt;= 4,
  &quot;Number of segments of the enhanced stratified tank should be no less than 4 (nSeg&gt;=4).&quot;);

  <span style="color: #006400; font-weight: normal; font-style: normal;">// assign zero flow conditions at port</span>
  fluidPort[:].m_flow =<span style="color: red; font-weight: normal; font-style: normal;"> zeros</span>(nSeg + 2);
  fluidPort[:].h_outflow =<span style="color: red; font-weight: normal; font-style: normal;"> zeros</span>(nSeg + 2);
  fluidPort[:].Xi_outflow =<span style="color: red; font-weight: normal; font-style: normal;"> zeros</span>(nSeg + 2, Medium.nXi);
  fluidPort[:].C_outflow =<span style="color: red; font-weight: normal; font-style: normal;"> zeros</span>(nSeg + 2, Medium.nC);

  <span style="color: #006400; font-weight: normal; font-style: normal;">// assign extended enthalpy vectors</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>1:nSeg + 2<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
    h[i] =<span style="color: red; font-weight: normal; font-style: normal;"> inStream</span>(fluidPort[i].h_outflow);
  <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;

  <span style="color: #006400; font-weight: normal; font-style: normal;">// Value that transitions between 0 and 1 as the flow reverses.</span>
  sig =<span style="color: red; font-weight: normal; font-style: normal;"> Modelica.Fluid.Utilities.regStep</span>(
    m_flow,
    1,
    0,
    m_flow_small);
  <span style="color: #006400; font-weight: normal; font-style: normal;">           // at surface between port_a and vol1</span>

  comSig = 1 - sig;

  <span style="color: #006400; font-weight: normal; font-style: normal;">// at surface between port_a and vol1</span>
  hOut[1] = sig*h[1] + comSig*h[2];
  <span style="color: #006400; font-weight: normal; font-style: normal;">// at surface between vol[nSeg] and port_b</span>
  hOut[nSeg + 1] = sig*h[nSeg + 1] + comSig*h[nSeg + 2];

  <span style="color: #006400; font-weight: normal; font-style: normal;">// Pros: These two equations can further reduce the temperature overshoot by using the upwind</span>
  <span style="color: #006400; font-weight: normal; font-style: normal;">// Cons: The minimum of nSeg hase to be 4 instead of 2.</span>
  hOut[2] = sig*h[2] + comSig*h[3];
  <span style="color: #006400; font-weight: normal; font-style: normal;">// at surface between vol1 and vol2</span>
  hOut[nSeg] = sig*h[nSeg] + comSig*h[nSeg + 1];
  <span style="color: #006400; font-weight: normal; font-style: normal;">// at surface between vol[nSeg-1] and vol[nSeg]</span>

  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>3:nSeg - 1<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
    <span style="color: #006400; font-weight: normal; font-style: normal;">// at surface between vol[i-1] and vol[i]</span>
    <span style="color: #006400; font-weight: normal; font-style: normal;">// QUICK method</span>
    hOut[i] = 0.5*(h[i] + h[i + 1]) - comSig*0.125*(h[i + 2] + h[i] - 2*h[i + 1])
       - sig*0.125*(h[i - 1] + h[i + 1] - 2*h[i]);
    <span style="color: #006400; font-weight: normal; font-style: normal;">//     hOut[i] = 0.5*(h[i]+h[i+1]); // Central difference method</span>
  <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;

  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>1:nSeg<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
    <span style="color: #006400; font-weight: normal; font-style: normal;">// difference between QUICK and UPWIND; index of H_flow is same as hOut</span>
    Q_flow[i] = m_flow*(hOut[i + 1] - hOut[i]) - (H_flow[i + 1] - H_flow[i]);
  <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;

  <span style="color: #006400; font-weight: normal; font-style: normal;">//   Q_flow_upWind = sum(Q_flow[i] for i in 1:nSeg); //Used to test the energy conservation</span>

  <span style="color: blue; font-weight: normal; font-style: normal;">for </span>i<span style="color: blue; font-weight: normal; font-style: normal;"> in </span>1:nSeg<span style="color: blue; font-weight: normal; font-style: normal;"> loop</span>
    <span style="color: #006400; font-weight: normal; font-style: normal;">// Add the difference back to the volume as heat flow. An under-relaxation is needed to reduce</span>
    <span style="color: #006400; font-weight: normal; font-style: normal;">// oscillations caused by high order method</span>
    heatPort[i].Q_flow = Q_flow[i]*alpha;
  <span style="color: blue; font-weight: normal; font-style: normal;">end for</span>;
<span style="color: blue; font-weight: normal; font-style: normal;">end </span>ThirdOrderStratifier;
</div>
<hr>
<address>
<a href="http://www.3ds.com/">Automatically generated</a> Mon Jul 13 14:26:12 2015.
</address>
</body>
</html>
